function getHandleBarHtml(e,t){return cables.templates[e]?cables.templates[e](t):(console.log("template not found: "+e),"")}function uuid(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}function getQueryVariable(e){const t=window.location.search.substring(1).split("&");for(let n=0;n<t.length;n++){const o=t[n].split("=");if(o[0]===e)return o[1]}return!1}function getSearchParams(e){const t={};return location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(e,n,o){t[n]=o})),e?t[e]:t}function getHashValue(e){const t=location.hash.match(new RegExp(e+"=([^&]*)"));return t?t[1]:null}function initPagination(e,t,n,o,s){n=Number(n),o=Number(o);document.querySelectorAll(e).forEach(e=>{if(e){const n=e.querySelector(".row.pagination");n&&n.remove(),e.innerHTML+=getHandleBarHtml("pagination",t)}});const i=e+" .pagination .tab-bar ";document.querySelectorAll(i+".prev").forEach(e=>{if(e){const t=()=>{const e=Math.max(0,o-n);s(n,e)};e.removeEventListener("pointerdown",t),e.addEventListener("pointerdown",t)}});document.querySelectorAll(i+".next").forEach(e=>{if(e){const i=()=>{const e=Math.min(t.count,o+n);s(n,e)};e.removeEventListener("pointerdown",i),e.addEventListener("pointerdown",i)}});document.querySelectorAll(i+".more").forEach(e=>{if(e){const t=()=>{s(0,0)};e.removeEventListener("pointerdown",t),e.addEventListener("pointerdown",t)}});document.querySelectorAll(i+"li.page").forEach((e,t)=>{e.addEventListener("pointerdown",o=>{let i=t;e.dataset.pageIndex&&(i=Number(e.dataset.pageIndex)-1);s(n,i*n)})})}(CABLES=CABLES||{}).EventTarget=function(){this._eventCallbacks={},this.addEventListener=function(e,t){this._eventCallbacks[e]?this._eventCallbacks[e].push(t):this._eventCallbacks[e]=[t]},this.hasEventListener=this.on=function(e,t){if(e&&t){if(this._eventCallbacks[e]){return-1!=this._eventCallbacks[e].indexOf(t)}}else console.log("hasListener: missing parameters")},this.removeEventListener=function(e,t){if(this._eventCallbacks[e]){const n=this._eventCallbacks[e].indexOf(t);-1==n?console.log("eventlistener "+e+" not found..."):this._eventCallbacks[e].splice(n)}},this.emitEvent=function(e,t,n,o,s,i,a){if(this._eventCallbacks[e])for(let r=0;r<this._eventCallbacks[e].length;r++)this._eventCallbacks[e][r]&&this._eventCallbacks[e][r](t,n,o,s,i,a)}},(CABLES=CABLES||{}).API=function(){function e(e,t,n,o,s,i){const a={method:e};"POST"!=e&&"PUT"!=e&&"PATCH"!=e&&"DELETE"!=e||(a.headers={Accept:"application/json","Content-Type":"application/json"},n&&(a.body=JSON.stringify(n))),fetch("/api/"+t,a).then((function(e){if(!e.ok)throw e;e.json?e.json().then((function(e){o&&o(e)})):(console.error("[cables_api] fetch err",e),s&&s(e))})).catch((function(n){console.warn("catch:",n),n.json?n.json().then((function(e){console.error(e),s&&s(e)})):(console.error("[cables_api] api fetch err",n,e,t),s&&s(n))}))}this.get=function(t,n,o){e("GET",t,{},n,o)},this.post=function(t,n,o,s){e("POST",t,n,o,s)},this.delete=function(t,n,o,s){e("DELETE",t,n,o,s)},this.put=function(t,n,o,s){e("PUT",t,n,o,s)},this.patch=function(t,n,o,s){e("PATCH",t,n,o,s)},this.sendErrorReport=function(e){const t={};if(t.time=Date.now(),t.url=document.location.href,t.infoPlatform=navigator.platform,t.infoLanguage=navigator.language,t.infoUserAgent=navigator.userAgent,window.gui){gui.project()&&(t.projectId=gui.project()._id),gui.user&&(t.username=gui.user.username,t.userId=gui.user.id);try{const e=gui.corePatch().cgl.gl.getExtension("WEBGL_debug_renderer_info");t.glRenderer=gui.corePatch().cgl.gl.getParameter(e.UNMASKED_RENDERER_WEBGL)}catch(e){console.log(e)}}t.exception={},e&&(t.exception={type:e.type,error:e.error,filename:e.filename,lineno:e.lineno,message:e.message},e.stack&&(t.stack=e.stack)),CABLES.api.post("errorReport",t,(function(e){}))}},CABLES.api||(CABLES.api=new CABLES.API);const logResult={};function showResult(e){const t=CABLES.Browser.browserCounter++;let n="";if(e.title){let t=e.info,o="";t||(e.success||(t="not available",o="not-available"),1==e.success&&(t="available")),n+='<div class="row header">    <div class="cute-5-phone cute-3-tablet left header-title">'+(e.title||"")+'</div>    <div class="cute-7-phone cute-9-tablet left header-info '+o+'">'+t+"</div></div>",e.html&&(n+='<div class="section row">',n+='    <div class="cute-11-tablet cute-1-tablet-offset left" style="padding-bottom:35px;">',n+=e.html,n+="    </div>",n+="</div>")}const o=ele.byId("results");return o&&(o.innerHTML+=n),t}function getDetailTitle(e){return"<br/><h5>"+e+"</h5><br/>"}function getDetail(e,t){return e+": <b>"+t+"</b><br/>"}(CABLES=CABLES||{}).getGPU=function(e){const t={};let n=e;n=n.replace("Mesa DRI ",""),n=n.replace("Mesa ",""),n=n.replace("NVIDIA Corporation, ",""),n=n.replace("Intel Open Source Technology Center, ",""),n=n.replace("(R)",""),n=n.replace("(TM)",""),n=n.replace("Direct3D11 vs_5_0 ps_5_0)",""),n=n.replace("Direct3D11 vs_4_1 ps_4_1)",""),n=n.replace("OpenGL Engine",""),n=n.replace("/PCIe/SSE2",""),n=n.replace("X.Org, ",""),n=n.replace("ATI Radeon","Radeon"),n=n.replace("with Max-Q Design",""),n=n.replace("Series",""),n=n.replace("  "," ");let o=n.split(/[,(/)]/),s=null;for(let e=0;e<o.length;e++){let t=o[e].trim();(0==t.indexOf("Radeon")||0==t.indexOf("NVIDIA")||0==t.indexOf("AMD")||0==t.indexOf("GeForce")||0==t.indexOf("Intel")||0==t.indexOf("Mali")||0==t.indexOf("Adreno")||0==t.indexOf("PowerVR")||0==t.indexOf("VMware")||0==t.indexOf("Apple"))&&(s=t)}s&&0==s.indexOf("Radeon")&&(s="AMD "+s),s&&0==s.indexOf("GeForce")&&(s="NVIDIA "+s),s||(t.gpu_unsure=!0,console.log("unsure of gpu:",e)),t.gpu=(s||e).trim();let i="";return e.toLowerCase().indexOf("nvidia")>-1&&(i="Nvidia"),e.toLowerCase().indexOf("geforce")>-1&&(i="Nvidia"),e.toLowerCase().indexOf("radeon")>-1&&(i="AMD"),e.toLowerCase().indexOf("amd ")>-1&&(i="AMD"),e.toLowerCase().indexOf("intel")>-1&&(i="Intel"),e.toLowerCase().indexOf("swiftshader")>-1&&(i="Google"),e.toLowerCase().indexOf("adreno")>-1&&(i="Qualcom"),e.toLowerCase().indexOf("mali-")>-1&&(i="ARM"),e.toLowerCase().indexOf("apple")>-1&&(i="Apple"),t.vendor=i,e.toLowerCase().indexOf("swiftshader")>-1&&(t.software=!0),t},CABLES.Browser={};const tests=[function(){logResult.browser=platform.name,logResult.browser_version=platform.version;showResult({hide:!0,title:"browser",info:platform.name+" "+platform.version,html:""})},function(){let e="";platform.os&&(platform.os.family&&(e+=platform.os.family+" ",logResult.os_family=platform.os.family),platform.os.version&&(e+=platform.os.version+" ",logResult.os_version=platform.os.version),platform.os.architecture&&(e+=platform.os.architecture+"bit ",logResult.os_architecture=platform.os.architecture),platform.product&&(e+="("+platform.product+")",logResult.product=platform.product)),logResult.language=navigator.language||navigator.userLanguage,showResult({hide:!0,title:"OS",info:e})},function(){let e,t,n;try{e=document.createElement("canvas");let o=0;if(t=e.getContext("webgl2",e),t?o=2:(t=e.getContext("webgl",e)||e.getContext("experimental-webgl",e),o=1),t){let s="";logResult.webgl_versionNum=o,n=t.getSupportedExtensions();const i=t.getParameter(t.VERSION);logResult.webgl_version=i;const a=t.getParameter(t.SHADING_LANGUAGE_VERSION);logResult.webgl_glsl_version=a;const r=t.getExtension("WEBGL_debug_renderer_info");if(r){const e=t.getParameter(r.UNMASKED_RENDERER_WEBGL);logResult.webgl_renderer=e,logResult.webgl_gpu_info=CABLES.getGPU(e),console.log(logResult.webgl_gpu_info);const n=t.getParameter(r.UNMASKED_VENDOR_WEBGL);logResult.webgl_vendor=n}e=document.createElement("canvas");const l=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});logResult.webgl_majorPerformanceCaveat=!l,logResult.webgl_params={},void 0!==t.MAX_SAMPLES&&(logResult.webgl_params.MAX_SAMPLES=t.getParameter(t.MAX_SAMPLES)),logResult.webgl_params.MAX_FRAGMENT_UNIFORM_VECTORS=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),logResult.webgl_params.MAX_VERTEX_UNIFORM_VECTORS=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),logResult.webgl_params.MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),logResult.webgl_params.DEPTH_BITS=t.getParameter(t.DEPTH_BITS),logResult.webgl_params.MAX_VARYING_VECTORS=t.getParameter(t.MAX_VARYING_VECTORS),logResult.webgl_params.MAX_VERTEX_ATTRIBS=t.getParameter(t.MAX_VERTEX_ATTRIBS),logResult.webgl_params.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),logResult.webgl_params.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),logResult.webgl_params.MAX_RENDERBUFFER_SIZE=t.getParameter(t.MAX_RENDERBUFFER_SIZE);const c=t.getExtension("WEBGL_draw_buffers");if(c?logResult.webgl_params.MAX_DRAW_BUFFERS=t.getParameter(c.MAX_DRAW_BUFFERS_WEBGL):void 0!==t.MAX_DRAW_BUFFERS&&(logResult.webgl_params.MAX_DRAW_BUFFERS=t.getParameter(t.MAX_DRAW_BUFFERS)),n&&0!==n.length){logResult.webgl_extensions=n;for(let e=0;e<n.length;e++)s+="&nbsp;&nbsp;&nbsp;- "+n[e]+"<br/>"}else;showResult({success:!0,title:"WebGL",info:"WebGL "+o,html:s})}else logResult.webgl_versionNum=0,showResult({success:!1,title:"webgl"})}catch(e){return}e=void 0},async function(){let e=null!=navigator.gpu;if(e||showResult({title:"WebGPU",success:!1}),logResult.api_webGpu=e,navigator.gpu){let t=null;try{t=await navigator.gpu.requestAdapter()}catch(e){console.log("webgpu ex",e),t=null}e=!!t,showResult({title:"WebGPU",success:e}),logResult.api_webGpu=e}},function(){let e=null!=window.VideoEncoder;showResult({title:"WebGPU",success:e}),logResult.api_webCodecs=e},function(){logResult.display_pixel_ratio=window.devicePixelRatio,window.devicePixelRatio&&(logResult.display_pixel_ratio_float=window.devicePixelRatio.toPrecision(2)),logResult.window_size_width=window.innerWidth,logResult.window_size_height=window.innerHeight,logResult.window_size_pixel_width=window.innerWidth*window.devicePixelRatio,logResult.window_size_pixel_height=window.innerHeight*window.devicePixelRatio,logResult.screen_size_width=window.screen.availWidth,logResult.screen_size_height=window.screen.availHeight;let e="";e+=getDetail("Device Pixel Ratio",window.devicePixelRatio),e+=getDetail("Screen Size",window.screen.availWidth+" x "+window.screen.availHeight),e+=getDetail("Window Size",window.innerWidth+" x "+window.innerHeight),e+=getDetail("Window Size Pixels",window.innerWidth*window.devicePixelRatio+" x "+window.innerHeight*window.devicePixelRatio),showResult({title:"Screen",info:window.innerWidth+" x "+window.innerHeight,html:e})},function(){const e=!!navigator.getGamepads;logResult.api_gamepad=e,showResult({success:e,title:"Gamepad API"});const t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++)t[e]&&showResult({text:t[e].index+": "+t[e].id})},function(){showResult({success:!!navigator.bluetooth||!1,title:"Bluetooth Web API"})},async function(){let e=navigator.xr;e&&(logResult.api_webxr=!!e,showResult({success:!!e,title:"WebXR"}),logResult.api_webxrvr=await e.isSessionSupported("immersive-vr"),showResult({success:logResult.api_webxrvr,title:"WebXR VR"}))},function(){let e="";window.RTCPeerConnection?e="":window.mozRTCPeerConnection||navigator.mozGetUserMedia?e="moz":(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)&&(e="webkit");const t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia,o=window.webkitMediaStream||window.MediaStream,s=window.mozRTCIceCandidate||window.RTCIceCandidate;logResult.api_webrtc_support=!!t&&!!n,logResult.api_webrtc_prefix=e,logResult.api_webrtc_peer_connection=!!t,logResult.api_webrtc_ice=!!s,logResult.api_webrtc_media_stream=!(!o||!o.prototype.removeTrack),logResult.api_webrtc_get_user_media=!!n,logResult.api_webrtc_data_channel=!!(t&&t.prototype&&t.prototype.createDataChannel),showResult({success:!!t&&!!n,title:"WebRTC"})},function(){navigator.getVRDisplays?navigator.getVRDisplays().then((function(e){for(let t=0;t<e.length;t++)logResult.api_webvr_display=e[t].displayName;const t=!!navigator.getVRDisplays;logResult.api_webvr=t,showResult({success:t,title:"WebVR API v1.1"})})):showResult({success:!!navigator.getVRDisplays,title:"WebVR API v1.1"})},function(){const e=!!window.MIDIAccess;logResult.api_midi=e;const t=showResult({success:e,title:"MIDI API"});window.MIDIAccess&&navigator.requestMIDIAccess({sysex:!1}).then((function(e){const n=e.inputs.values();for(let e=n.next();e&&!e.done;e=n.next())showResult({text:e.value.name,parent:t})}),(function(){}))},function(){let e=!1;window.audioContext&&(e=!0),e||!("webkitAudioContext"in window)&&!("AudioContext"in window)||(e=!0),logResult.api_webaudio=e,showResult({success:e,title:"webAudio"})},function(){const e="fonts"in document;logResult.api_fonts=e,showResult({success:e,title:"font loading api"})},function(){const e="exitPointerLock"in document;logResult.api_pointerlock=e,showResult({success:e,title:"mouse pointerlock"})},function(){const e="performance"in window;logResult.api_performanceTimer=e,showResult({success:e,title:"high resolution timer"})},function(){const e=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);logResult.api_svg=e,showResult({success:e,title:"SVG"})},function(){const e="WebSocket"in window;logResult.api_websocket=e,showResult({success:e,title:"WebSockets"})},function(){const e="bluetooth"in navigator;logResult.api_bluetooth=e,showResult({success:e,title:"Bluetooth API"})},function(){const e="BroadcastChannel"in window;logResult.api_broadcastchannel=e,showResult({success:e,title:"Broadcast Channel"})},function(){const e="Notification"in window;logResult.api_notifications=e,showResult({success:e,title:"Notification API"})},function(){const e="share"in navigator;logResult.api_webshare=e,showResult({success:e,title:"Web Share API"})}];function logEventObject(e,n,o,s){if((s=s||0)>3)return"oops";o=o||"";for(const e in n)if("parent"!=e)if(n[e]&&"number"!=typeof n[e]&&"boolean"!=typeof n[e]&&"string"!=typeof n[e])if(Array.isArray(n[e])){let t="";try{t=JSON.stringify(n[e])}catch(n){}o+="<tr><td>"+e+"</td><td>"+t+"</td></tr>"}else{if(!n[e].constructor)return;t="["+typeof n[e]+"] ";const s=n[e].constructor;s.name&&"Function"!=s.name&&(t+=s.name),o+="<tr><td>"+e+"</td><td>"+t+"</td></tr>"}else o+="<tr><td>"+e+'</td><td style="width:100%">',CABLES.lastBrowserEvent[n.type]&&CABLES.lastBrowserEvent[n.type][e]==n[e]||(o+="<b>"),o+=n[e],CABLES.lastBrowserEvent[n.type]&&CABLES.lastBrowserEvent[n.type][e]==n[e]||(o+="</b>"),o+="</td></tr>";return CABLES.lastBrowserEvent[n.type]=n,o}function logBrowserEvent(e){e.preventDefault();CABLES.browserEventHistory.unshift(e.type),CABLES.browserEventHistory.length>50&&(CABLES.browserEventHistory.length=50);let t="";for(let e=0;e<CABLES.browserEventHistory.length;e++)t+=CABLES.browserEventHistory[e]+"<br/>";document.getElementById("history").innerHTML=t;let n="";return n+="<h3>"+e.type+"</h3><br/>",n+="<table>",n+=logEventObject(e,e,"",0),n+="</table>",document.getElementById("output").innerHTML=n,!1}function initBrowserEvents(){document.getElementById("results").innerHTML="",window.addEventListener("load",logBrowserEvent),window.addEventListener("gamepadconnected",logBrowserEvent),window.addEventListener("DOMContentLoaded",logBrowserEvent),window.addEventListener("gamepadconnected",logBrowserEvent),window.addEventListener("gamepaddisconnected",logBrowserEvent),document.addEventListener("keydown",logBrowserEvent),document.addEventListener("keyup",logBrowserEvent),document.addEventListener("scroll",logBrowserEvent),document.getElementById("input").addEventListener("focus",logBrowserEvent),document.getElementById("input").addEventListener("blur",logBrowserEvent),document.getElementById("input").addEventListener("contextmenu",logBrowserEvent),document.getElementById("input").addEventListener("mouseenter",logBrowserEvent),document.getElementById("input").addEventListener("mouseleave",logBrowserEvent),document.getElementById("input").addEventListener("mousemove",logBrowserEvent),document.getElementById("input").addEventListener("pointerenter",logBrowserEvent),document.getElementById("input").addEventListener("pointerleave",logBrowserEvent),document.getElementById("input").addEventListener("pointermove",logBrowserEvent),document.getElementById("input").addEventListener("mousedown",logBrowserEvent),document.getElementById("input").addEventListener("mouseup",logBrowserEvent),document.getElementById("input").addEventListener("pointerdown",logBrowserEvent),document.getElementById("input").addEventListener("pointerup",logBrowserEvent),document.getElementById("input").addEventListener("click",logBrowserEvent),document.getElementById("input").addEventListener("dblclick",logBrowserEvent),document.getElementById("input").addEventListener("wheel",logBrowserEvent),document.getElementById("input").addEventListener("touchmove",logBrowserEvent),document.getElementById("input").addEventListener("touchstart",logBrowserEvent),document.getElementById("input").addEventListener("touchend",logBrowserEvent)}function saveDoc(e){CABLES.api.post("doc/ops/edit/"+e,{content:editor.getValue()},(function(e){console.log("res",e),e.success?document.getElementById("save_status").innerHTML="&nbsp;&nbsp;saved...":document.getElementById("save_status").innerHTML="&nbsp;&nbsp;not saved :/",setTimeout((function(){document.getElementById("save_status").innerHTML=""}),500)}),(function(e){console.log("err res",e)}))}CABLES.doBrowserTest=async function(e){for(const e in tests)await tests[e]();CABLES.CLIENT.COOKIES.createCookie("browserinfo",!0,100),CABLES.api.post("browser",{browser:logResult},t=>{console.log(t);const n=document.getElementById("resultIframe");n&&(n.src="/browser/r/"+t.id);const o=document.getElementsByTagName("head");if(o&&o.length>0){const e=document.createElement("base");e.setAttribute("target","_parent"),o[0].appendChild(e)}const s=document.getElementsByTagName("footer");s&&s.length>0&&s[0].remove(),e&&e(t)})},CABLES.doBrowserSpeedTest=function(e){function t(e){let t="abcdefghijklmnopqrstuvwxyz".split(""),n=t.length,o=[];for(;e--;)o.push(t[Math.random()*n|0]);return o.join("")}function n(e,t,n,o){const s=n.dir,i=document.getElementById("speedtestResult").querySelector(".results");if(n.result.clientDiff){i.querySelector("."+e+" .client .time").innerHTML=parseInt(n.result.clientDiff)+"ms";const o=i.querySelector("."+e+" .client .speed");o.innerHTML=parseInt(Number(n.result.clientDiff-n.result.diff))+"ms";const s=8*t/1024/1024/(n.result.clientDiff/1e3);o.innerHTML=s.toFixed(2)+" mbit/s"}if(n.result.hasOwnProperty("processingTime")){i.querySelector("."+e+" .servertime").innerHTML=parseInt(n.result.processingTime)+"ms"}if(s){if(o){const e=ele.byQuery("."+s+" .loading");e&&ele.hide(e)}ele.byQueryAll("."+s+" .result").forEach(e=>{ele.show(e)})}}function o(e){CABLES.stopSavingAnimButton();const t=document.getElementById("speedtestResult").querySelector(".error");if(t){t.classList.remove("hidden");const n=t.querySelector(".message");n&&(n.innerHTML="error during speedtest:"+e)}}CABLES.startSavingAnimButton(e);const s={};ele.byQueryAll(".results .result").forEach(e=>{ele.hide(e)});ele.byQueryAll(".results .loading").forEach(e=>{ele.show(e)});document.getElementById("speedtestResult").querySelector(".results").classList.remove("hidden");const i=performance.now(),a=Date.now();fetch("/test_files/onemb.txt?cb="+a).then(e=>e.text()).then(()=>{let e=performance.now(),r={};r.clientStart=i,r.clientEnd=e,r.clientDiff=e-i,s.fetchDirectSmall={dir:"downdirect",size:"small",result:r},n("downdirectsmall",1048576,s.fetchDirectSmall);const l=performance.now();CABLES.api.get("browser/download/small?cb="+a,e=>{const i=performance.now();r={},e.data&&(r=e.data),e.data.data&&delete e.data.data,r.clientStart=l,r.clientEnd=i,r.clientDiff=i-l,s.fetchSmall={dir:"down",size:"small",result:r},n("downsmall",1048576,s.fetchSmall);const c=performance.now();fetch("/test_files/tenmb.txt?cb="+a).then(e=>e.text()).then(()=>{const e=performance.now();r={},r.clientStart=c,r.clientEnd=e,r.clientDiff=e-c,s.fetchDirectBig={dir:"downdirect",size:"big",result:r},n("downdirectbig",10485760,s.fetchDirectBig,!0);const i=performance.now();CABLES.api.get("browser/download/big?cb="+a,e=>{const a=performance.now();r={},e.data&&(r=e.data),e.data.data&&delete e.data.data,r.clientStart=i,r.clientEnd=a,r.clientDiff=a-i,s.fetchBig={dir:"down",size:"big",result:r},n("downbig",10485760,s.fetchBig,!0);let l={data:t(1048576)};const c=performance.now();CABLES.api.post("browser/upload/small",l,e=>{const i=performance.now();r={},e.data&&(r=e.data),e.data.data&&delete e.data.data,r.clientStart=c,r.clientEnd=i,r.clientDiff=i-c,s.upSmall={dir:"up",size:"small",result:r},n("upsmall",1048576,s.upSmall),l={data:t(10485760)};const a=performance.now();CABLES.api.post("browser/upload/big",l,e=>{const t=performance.now();r={},e.data&&(r=e.data),e.data.data&&delete e.data.data,r.clientStart=a,r.clientEnd=t,r.clientDiff=t-a,s.upBig={dir:"up",size:"big",result:r},n("upbig",10485760,s.upBig,!0),CABLES.stopSavingAnimButton(),CABLES.api.post("browser/speedtest",s)},o)},o)},o)},o)},o)},o)},CABLES.Browser.browserCounter=0,(CABLES=CABLES||{}).lastBrowserEvent={},CABLES.browserEventHistory=[],(CABLES=CABLES||{}).startSavingAnimButton=e=>{if(!e.classList.contains("buttonSavingAnim")){CABLES.buttonSavingEle=e,CABLES.buttonSavingText=e.innerText,e.innerText="Working...";const t=document.createElement("span");t.classList.add("icon-loader"),t.classList.add("icon"),t.classList.add("icon-0_75x"),t.style["margin-left"]="10px",e.classList.add("buttonSavingAnim"),e.appendChild(t),CABLES.buttonSavingStart=performance.now()}},CABLES.stopSavingAnimButton=(e=!0)=>{if(performance.now()-CABLES.buttonSavingStart<200)return void setTimeout(()=>{CABLES.stopSavingAnimButton()},50);const t=document.querySelectorAll(".buttonSavingAnim .icon-loader"),n=document.querySelectorAll(".buttonSavingAnim");if(CABLES.buttonSavingEle&&(e&&(CABLES.buttonSavingEle.innerText="Done !"),setTimeout(()=>{CABLES.buttonSavingEle.innerText=CABLES.buttonSavingText},400)),n)for(let e=0;e<n.length;e++)n[e].classList.remove("buttonSavingAnim");if(t)for(let e=0;e<t.length;e++)t[e].remove()},window.Handlebars&&(Handlebars.registerHelper("compare",(function(e,t,n,o){let s,i;if(arguments.length<4)throw new Error("Handlerbars Helper 'compare' needs 3 parameters, left value, operator and right value");if(s={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},typeof:function(e,t){return typeof e==t}},!s[t])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+t);return i=s[t](e,n),!0===i?o.fn(this):o.inverse(this)})),Handlebars.registerHelper("paginationLoop",(function(e){let t=Number(this.currentPage)||0,n=t+19;n>this.pages&&(n=this.pages);let o=t-10;o<1&&(o=1);t+19>this.pages&&(o=this.pages-19),o<1&&(o=1);let s="",i=0;for(let t=o;t<=n&&!(i>19);t++){let a=t===n;19===i&&(a=!0),s+=e.fn({page:t,last:a,first:t==o}),i++}return s}))),(CABLES=CABLES||{}).CLIENT=CABLES.CLIENT||{},CABLES.CLIENT.COOKIES=CABLES.CLIENT.COOKIES||{},CABLES.CLIENT.COOKIES.KEYS=CABLES.CLIENT.COOKIES.KEYS={},CABLES.CLIENT.COOKIES.KEYS.ACCEPTED="accepted",CABLES.CLIENT.COOKIES.createCookie=function(e,t,n){let o="";if(n){const e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),o="; expires="+e.toUTCString()}document.cookie=e+"="+t+o+"; path=/; secure=true; SameSite=lax"},CABLES.CLIENT.COOKIES.readCookie=function(e){const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let o=n[e];for(;" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},CABLES.CLIENT.COOKIES.eraseCookie=function(e){CABLES.CLIENT.COOKIES.createCookie(e,"",-1)},CABLES.CLIENT.COOKIES.didUserAccept=function(){return CABLES.CLIENT.COOKIES.readCookie(CABLES.CLIENT.COOKIES.KEYS.ACCEPTED)},CABLES.CLIENT.COOKIES.handleAcceptClick=function(){const e=document.querySelector(".cookie-warning");e&&(e.style.display="none"),CABLES.CLIENT.COOKIES.createCookie(CABLES.CLIENT.COOKIES.KEYS.ACCEPTED,!0,3650)},CABLES.CLIENT.COOKIES.showWarning=function(){if(document.body){if(document.body.classList.contains("no-cookie-warning"))return;const e=document.createElement("div");e.className="cookie-warning";const t='<p class="cookie-warning-text">cables.gl uses <strong>only functional cookies</strong> to ensure that everything works fine for you. If you continue we’ll assume that you are happy to receive these cookies on cables.</p>',n=document.createElement("div");n.id="cookie-close-icon",n.onclick=CABLES.CLIENT.COOKIES.handleAcceptClick,e.innerHTML=t,e.appendChild(n),document.body.appendChild(e)}},CABLES.CLIENT.COOKIES.showWarningIfNotAccepted=void(CABLES.CLIENT.COOKIES.didUserAccept()||CABLES.CLIENT.COOKIES.showWarning());class Ele{byId(e){return e&&"#"==e[0]&&console.warn("ele.byId should not contain #"),document.getElementById(e)}byQuery(e){return document.querySelector(e)}byQueryAll(e){return document.querySelectorAll(e)}byClass(e){e&&"."==e[0]&&console.warn("ele.byClass should not contain .");const t=document.getElementsByClassName(e);return t.length>0?t[0]:null}byClassAll(e){e&&"."==e[0]&&console.warn("ele.byClassAll should not contain .");const t=document.getElementsByClassName(e);return t||[]}forEachClass(e,t){e&&"."==e[0]&&console.warn("ele.forEachClass should not contain .");const n=document.getElementsByClassName(e);for(let e=0;e<n.length;e++)t(n[e])}getSelectValue(e){return e.options[e.selectedIndex].value||e.options[e.selectedIndex].text}show(e){e&&e.classList.remove("hidden")}hide(e){e&&e.classList.add("hidden")}toggle(e){e.classList.contains("hidden")?e&&e.classList.remove("hidden"):e&&e.classList.add("hidden")}create(e){return document.createElement(e)}hasFocus(e){return document.activeElement==e}isVisible(e){return!("none"===window.getComputedStyle(e).display)}append(e,t){e.innerHTML+=t}}function handlePopState(e){if(!e.originalEvent)return!0;const t=e.originalEvent.state;t&&t.exampleName&&t.exampleId?(CABLES.EXAMPLES.state.exampleName=e.originalEvent.state.exampleName,CABLES.EXAMPLES.state.exampleId=e.originalEvent.state.exampleId,loadExampleAndShow(CABLES.EXAMPLES.state.exampleId,!1)):(CABLES.EXAMPLES.state.exampleName=null,CABLES.EXAMPLES.state.exampleId=null,loadExampleAndShow(null,!1)),CABLES.EXAMPLES.state.exampleName||(ele.hide(ele.byId("example-detail")),ele.show(ele.byId("example-thumbs")))}function showExample(e,t){let n;t&&updateState(e.name,e._id),ele.show(ele.byId("example-detail")),ele.hide(ele.byId("example-thumbs")),replaceTags(e.tags),replaceDescription(e.description),ele.byId("example-name").innerHTML=e.name,n=e._id?"/view/"+e._id:"";ele.byQuery("iframe").outerHTML='<iframe src="'+n+'"></iframe>';let o=e._id;e.shortId&&(o=e.shortId),ele.byId("open-project-button").setAttribute("href","/edit/"+o)}function getEmptyExample(){return{_id:null,name:"",tags:[],description:""}}function replaceDescription(e){e||(e=""),ele.byId("example-description").innerHTML=marked(e)}function replaceTags(e){const t=ele.byQuery(".tag-list-wrapper");if(t){if(t.innerHTML="",!e||0===e.length)return;e.forEach((function(e){const n=document.createElement("a");n.setAttribute("href","/tag/"+e),n.classList.add("tag"),n.innerHTML=e,t.appendChild(n)}))}}function updateState(e,t){if(e){if(window.hasOwnProperty("history")){const n={exampleName:e,exampleId:t},o="/examples/"+encodeURIComponent(e.trim());window.history.pushState(n,null,o),CABLES.EXAMPLES.state=n}}else console.error("no example name")}function handleExampleLinkClick(e){e.preventDefault(),e.stopPropagation();const t=e.target.dataset.id;return t!==CABLES.EXAMPLES.state.exampleId&&loadExampleAndShow(t,!0),!1}function loadExampleAndShow(e,t){e?CABLES.api.get("project/"+e,(function(e){showExample(e,t)})):showExample(getEmptyExample(),t)}function dataUriToFormData(e,t){let n;n=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);const o=e.split(",")[0].split(":")[1].split(";")[0],s=new Uint8Array(n.length);for(let e=0;e<n.length;e++)s[e]=n.charCodeAt(e);const i=new Blob([s],{type:o}),a=new FormData;return a.append(0,i,t),a}(CABLES=CABLES||{}).EXAMPLES=CABLES.EXAMPLES||{},CABLES.EXAMPLES.state={exampleName:null,exampleId:null},window.location.href.indexOf("/examples")>-1&&document.addEventListener("DOMContentLoaded",()=>{const e=ele.byId("example-page");CABLES.EXAMPLES.state={exampleName:e.dataset.exampleName,exampleId:e.dataset.exampleId},e.dataset.exampleName?CABLES.api.get("project/"+CABLES.EXAMPLES.state.exampleId,(function(e){showExample(e,!1)})):(CABLES.API.getExamples({selector:"#example-thumbs"}),window.history.pushState(CABLES.EXAMPLES.state,null,window.location.href),window.addEventListener("popstate",handlePopState)),ele.byQueryAll(".example-link").forEach(e=>{e.addEventListener("pointerdown",handleExampleLinkClick)}),ele.byQueryAll(".example-link-unsorted").forEach(e=>{e.addEventListener("pointerdown",handleExampleLinkClick)})}),CABLES.exportDialog=class{constructor(e){this._id=e,this._currentTab="",this.setTab("download")}setTab(e){this._currentTab&&(ele.hide(ele.byId("tab_"+this._currentTab)),ele.byId("tabitem_"+this._currentTab).classList.remove("active")),ele.show(ele.byId("tab_"+e)),ele.byId("tabitem_"+e).classList.add("active"),this._currentTab=e,window.location.hash="t="+e;let t="Export ZIP File";"netlify"===e&&(t="Deploy to Netlify"),"github"===e&&(t="Deploy to Github"),"exe"===e&&(t="Build Executable"),ele.byId("exportbutton").value=t,ele.byId("deploymentbutton").value="View Deployment",ele.byId("overviewbutton").innerHTML="Deployments overview","cmdline"===e||"iframe"===e?(ele.hide(ele.byId("exportoptions")),ele.hide(ele.byId("exportbutton"))):(ele.show(ele.byId("exportbutton")),ele.show(ele.byId("exportoptions"))),ele.byQueryAll(".exportOptionPanel").forEach(e=>{ele.hide(e)}),ele.show(ele.byId("export_options_"+this._currentTab))}_exportFinished(e,t){ele.hide(ele.byId("export_loading")),e&&(alert("export error"),console.log(e)),ele.byId("export_log").innerHTML=t.log||t.message,t.urls&&(t.urls.downloadUrl?(ele.show(ele.byId("downloadbutton")),ele.byId("downloadbutton").setAttribute("href",t.urls.downloadUrl)):ele.hide(ele.byId("downloadbutton")),t.urls.deploymentUrl?(ele.show(ele.byId("deploymentbutton")),ele.byId("deploymentbutton").setAttribute("href",t.urls.deploymentUrl)):ele.hide(ele.byId("deploymentbutton")),t.urls.overviewUrl?(ele.show(ele.byId("overviewbutton")),ele.byId("overviewbutton").setAttribute("href",t.urls.overviewUrl)):ele.hide(ele.byId("overviewbutton"))),ele.hide(ele.byId("export_dialog")),ele.show(ele.byId("export_result"))}export(){ele.hide(ele.byId("export_dialog")),ele.show(ele.byId("export_loading"));let e="project/"+this._id+"/export?a=1";e+="&type="+this._currentTab,e+="&assets="+ele.byId("export_settings_assets").value,"none"===ele.byId("export_settings_assets").value&&(e+="&ignoreAssets=true"),"single"===ele.byId("export_settings_combine").value&&(e+="&combineJS=true"),ele.byId("export_settings_skip_backups").checked&&(e+="&skipBackups=true"),ele.byId("export_settings_flat").checked&&(e+="&flat=true");document.querySelectorAll("#export_options_"+this._currentTab+" .exportOption").forEach(t=>{e+="&"+t.dataset.name+"="+encodeURIComponent(t.value)}),CABLES.api.get(e,e=>{this._exportFinished(null,e)},e=>{this._exportFinished(e,e)})}},CABLES.invitations=CABLES.invitations||{},CABLES.invitations.acceptPatchInvitation=function(e,t=null,n=!1){CABLES.api.post("patchinvite/"+e+"/accepted",{readOnly:n},(function(){t?window.location.href=t:window.location.reload()}),(function(){t?window.location.href=t:window.location.reload()}))},CABLES.invitations.declinePatchInvitation=function(e,t=null){CABLES.api.post("patchinvite/"+e+"/declined",{},(function(){t?window.location.href=t:window.location.reload()}),(function(){t?window.location.href=t:window.location.reload()}))},CABLES.invitations.leaveProject=function(e,t=null){confirm("really remove yourself as collaborator?")&&CABLES.api.patch("project/leave/"+e,{},(function(){t?window.location.href=t:window.location.reload()}),(function(e){alert("ERROR: "+e.msg)}))},CABLES.invitations.acceptTeamInvitation=function(e,t=null,n=!1){CABLES.api.post("teaminvites/"+e+"/accepted",{readOnly:n},(function(){t?window.location.href=t:window.location.reload()}),(function(){t?window.location.href=t:window.location.reload()}))},CABLES.invitations.declineTeamInvitation=function(e,t=null){CABLES.api.post("teaminvites/"+e+"/declined",{},(function(){t?window.location.href=t:window.location.reload()}),(function(){t?window.location.href=t:window.location.reload()}))},CABLES.API.requestPatchAccess=function(e){CABLES.api.post("patchinvite/request/"+e,{},e=>{ele.hide(ele.byId("request-access-button")),ele.show(ele.byId("request-pending-button"))})},CABLES.API.requestTeamAccess=function(e,t=!1){const n={};t&&(n.permission=t),CABLES.api.post("teaminvites/request/"+e,n,e=>{ele.hide(ele.byId("request-access-button")),ele.show(ele.byId("request-pending-button"))})},(CABLES=CABLES||{}).lazyLoad=function(){CABLES.revalidateLazyLoad(),setTimeout((function(){CABLES.revalidateLazyLoad()}),100),setTimeout((function(){CABLES.revalidateLazyLoad()}),500)},CABLES.revalidateLazyLoad=function(){CABLES.blazy.revalidate();document.querySelectorAll(".ribbon--example").forEach(e=>{e.dataset.hasOwnProperty("exampleFor")&&e.dataset.exampleFor&&e.addEventListener("click",()=>{window.location.href="/op/"+e.dataset.exampleFor})});document.querySelectorAll(".ribbon--featured").forEach(e=>{e.addEventListener("click",()=>{window.location.href="/patches?s=&w=featured"})})},CABLES.ajaxLogin=function(){const e={username:ele.byId("login_username").value,password:ele.byId("login_password").value};CABLES.api.post("loginajax",e,(function(e){if(e.success){const e=ele.byId("successRedir");e&&(e.value=document.location.pathname),ele.byId("loginform").submit()}else{let t="Login failed";e.error&&(t+=": "+e.error);const n=ele.byQuery(".errors_login");n.style.display="block",n.innerHTML="",n.innerHTML=t}}),(function(e){const t=ele.byQuery(".errors_login");t.style.display="block",t.innerHTML="",t.innerHTML="something went wrong... no success"}))},CABLES.signup=function(){const e={username:ele.byId("username").value,password:ele.byId("password").value,email:ele.byId("email").value,newsletter:document.getElementById("newslettercheckbox").checked},t=ele.byId("secret");if(t&&(e.secred=t.value),!document.getElementById("privacycheckbox").checked)return ele.byQuery(".errors_signup").style.display="block",void(ele.byQuery(".errors_signup").innerHTML="Please read and accept the privacy policy");ele.byQuery(".errors_signup").style.display="none",ele.byQuery(".errors_signup").innerHTML="",CABLES.api.post("user/signup",e,(function(e){"SUCCESS"==e.status&&e.goto?ele.byQuery(".tab_content_signup").innerHTML='<center>Thank you for signing up! <br/><br/>Please check your inbox to confirm your email. <br/>After that you can <a href="/login">login</a></center>':(ele.byQuery(".errors_signup").style.display="block",ele.byQuery(".errors_signup").innerHTML="",ele.byQuery(".errors_signup").innerHTML="something went wrong... no success "+e.errors)}),(function(e){if(ele.byQuery(".errors_signup").style.display="block",ele.byQuery(".errors_signup").innerHTML="",e.errors&&e.errors.length>0){if(e.errors.includes("MAINTENANCE_MODE")||(ele.byQuery(".errors_signup").innerHTML="Please check your data:<br/><br/>"),e.errors)for(const t in e.errors)"EMAIL_INVALID"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="- This is not a valid email<br/>":"PASSWORD_TOO_SHORT"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="- Please use a longer password<br/>":"USERNAME_TOO_SHORT"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="- Please use a longer username<br/>":"EMAIL_EXISTS"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="- This email is already registered<br/>":"USER_EXISTS"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="- Username already exists<br/>":"INVALID CHARACTERS"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="- Please do not use any special characters or spaces in your username<br/>":"ERROR_USERNAME_EQUALS_EMAIL"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="- Your username cannot be your email-address<br/>":"MAINTENANCE_MODE"===e.errors[t]?ele.byQuery(".errors_signup").innerHTML+="cables is currently in maintenance mode,<br/>please try again later":ele.byQuery(".errors_signup").innerHTML+="- "+e.errors[t]+"<br/>"}else ele.byQuery(".errors_signup").innerHTML="something went wrong..."}))},CABLES.signupNewsletter=function(){const e={username:ele.byId("username").value,password:ele.byId("password").value,email:ele.byId("email").value},t=ele.byId("secret");t&&(e.secred=t.value),CABLES.api.post("user/signupNewsletter",e,(function(e){"SUCCESS"==e.status&&e.goto?(ele.byQuery(".errors_signup").style.display="none",ele.byQuery(".tab_content_signup").innerHTML="Thank you for signing up! "):(ele.byQuery(".errors_signup").style.display="block",ele.byQuery(".errors_signup").innerHTML="",ele.byQuery(".errors_signup").innerHTML="something went wrong... no success")}),(function(e){if(ele.byQuery(".errors_signup").style.display="block",ele.byQuery(".errors_signup").innerHTML="",e.errors&&e.errors.length>0){ele.byQuery(".errors_signup").innerHTML="please check your data:<br/><br/>";for(const t in e.errors)ele.byQuery(".errors_signup").innerHTML+="- "+e.errors[t]+"<br/>"}else ele.byQuery(".errors_signup").innerHTML+="something went wrong..."}))},CABLES.setResetPassword=function(e,t){const n={password:ele.byId("password").value,hash:ele.byId("hash").value};CABLES.api.post("user/setResetPassword",n,(function(e){e.success?(ele.byQuery(".errors").style.display="block",ele.byQuery(".errors").innerHTML="",ele.byQuery(".tab_content_signup").innerHTML='new password set!<br/><br/><a href="/login">login now</a>'):(ele.byQuery(".errors").style.display="block",ele.byQuery(".errors").innerHTML="",ele.byQuery(".errors").innerHTML="something went wrong... no success")}),(function(e){if(ele.byQuery(".errors").style.display="block",ele.byQuery(".errors").innerHTML="",e.errors&&e.errors.length>0){e.errors.includes("USER_LOGGED_IN")||(ele.byQuery(".errors").innerHTML="please check your data:<br/><br/>");for(const t in e.errors)"USER_LOGGED_IN"===e.errors[t]?ele.byQuery(".errors").innerHTML+="you are currently logged in, <a href='/logout'>log out</a> to reset your password":ele.byQuery(".errors").innerHTML+="- "+e.errors[t]+"<br/>"}else ele.byQuery(".errors").innerHTML+="something went wrong..."}))},CABLES.resetPassword=function(){const e={email:ele.byId("email").value};CABLES.api.post("user/resetPassword",e,(function(e){e.success?(ele.byQuery(".errors").style.display="block",ele.byQuery(".errors").innerHTML="",ele.byQuery(".errors").innerHTML="password reset email sent!",ele.byId("resetpasswdbutton").style.display="none",ele.byId("email").style.display="block"):(ele.byQuery(".errors").style.display="block",ele.byQuery(".errors").innerHTML="",ele.byQuery(".errors").innerHTML="something went wrong... no success")}),(function(e){if(ele.byQuery(".errors").style.display="block",ele.byQuery(".errors").innerHTML="",e.errors&&e.errors.length>0){e.errors.includes("USER_LOGGED_IN")||(ele.byQuery(".errors").innerHTML="please check your data:<br/><br/>");for(const t in e.errors)"USER_LOGGED_IN"===e.errors[t]?ele.byQuery(".errors").innerHTML+="you are currently logged in, <a href='/logout'>log out</a> to reset your password":ele.byQuery(".errors").innerHTML+="- "+e.errors[t]+"<br/>"}else ele.byQuery(".errors").innerHTML+="something went wrong..."}))},CABLES.resendConfirmEmail=function(){const e={email:ele.byId("email").value};CABLES.api.post("send_confirm/",e,(function(e){e.success?(ele.byId("result").innerHTML="password reset email sent!",ele.byId("form").style.display="none"):(ele.byId("result").innerHTML="something went wrong... no success",ele.byId("form").style.display="none")}),(function(e){ele.byId("result").innerHTML="something went wrong... no success",ele.byId("form").style.display="none"}))},CABLES.showInfoBar=function(e,t){const n=document.getElementById("nav-infobar");n&&(n.innerHTML=e,n.classList.remove("warning"),n.classList.remove("info"),n.classList.remove("neutral"),n.classList.add(t),n.style.display="block")},CABLES.hideInfoBar=function(){const e=document.getElementById("nav-infobar");e&&(e.innerHTML="",e.classList.remove("warning"),e.classList.remove("info"),e.classList.remove("neutral"),e.style.display="none")},(CABLES=CABLES||{}).SandboxEditor=function(e){const t=document.getElementById("editorIframe");CABLES.talker=new CABLES.TalkerAPI(t.contentWindow),CABLES.patchId=e.config.patchId,CABLES.patchVersion=e.config.patchVersion,CABLES.talker.addEventListener("requestPatchData",(function(t,n){n&&n(e.config)})),CABLES.talker.addEventListener("sendBrowserInfo",(function(e,t){t&&t(platform)})),CABLES.talker.addEventListener("addMeUserlist",(function(t,n){console.log(e),CABLES.api.put("project/"+CABLES.patchId+"/user/"+e.config.user.id,(function(e){n(null,e)}),(function(e){n(e,e)}))})),CABLES.talker.addEventListener("checkProjectUpdated",(function(e,t){CABLES.api.get("project/"+e.projectId+"/updated",(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("patchCreateBackup",(function(e,t){CABLES.api.put("projectversion/createbackup/"+CABLES.patchId,{title:e.title},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("reload",(function(e,t){document.location.reload()})),CABLES.talker.addEventListener("savePatch",(function(e,t){e.buildInfo&&(e.buildInfo.host=location.hostname);let n="project/"+e.id;e.fromBackup&&(n+="?fromBackup=true"),CABLES.api.put(n,{name:e.name,namespace:e.namespace,data:e.data,dataB64:e.dataB64,buildInfo:e.buildInfo},(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("getPatch",(function(t,n){let o="project/"+CABLES.patchId;e.config.patchVersion&&(o+="/version/"+e.config.patchVersion),CABLES.api.get(o,(function(e){n(null,e)}),(function(e){n(e,e)}))})),CABLES.talker.addEventListener("gotoPatch",(function(e){document.location.href="/edit/"+e.id})),CABLES.talker.addEventListener("newPatch",(function(e,t){CABLES.api.post("project",{name:e.name},(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("saveProjectAs",(function(e,t){CABLES.api.post("project/copy",{name:e.name,originalId:e.originalId,copyCollaborators:e.copyCollaborators},(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("saveScreenshot",(function(e,t){CABLES.api.put("project/"+e.id+"/screenshot",{screenshot:e.screenshot},(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("getBuildInfo",(e,t)=>{CABLES.api.get("buildinfo/?nc="+Date.now(),(function(e){t(null,e.data)}),(function(e){t(e,e)}))}),CABLES.talker.addEventListener("getFilelist",(e,t)=>{let n="library/";"patch"==e.source&&(n="project/"+CABLES.patchId+"/files/"),CABLES.api.get(n,(function(e){t(null,e)}),(function(e){t(e,e)}))}),CABLES.talker.addEventListener("fileConvert",(e,t)=>{CABLES.api.post("project/"+CABLES.patchId+"/file/convert/"+e.fileId+"/"+e.converterId,{options:e.options},(function(e){console.log(e),e&&e.filename&&CABLES.talker.send("fileUpdated",{filename:e.filename}),t(null,e)}),(function(e){t(e,e)}))}),CABLES.talker.addEventListener("updatePatchName",(e,t)=>{document.title=e.name}),CABLES.talker.addEventListener("getFileDetails",(e,t)=>{CABLES.api.get("project/"+CABLES.patchId+"/file/info/"+e.fileid,(function(e){t(null,e)}),(function(e){t(e,e)}))}),CABLES.talker.addEventListener("getLibraryFileInfo",(e,t)=>{CABLES.api.get("files/library/info/"+e.fileCategory+"/"+e.filename,e=>t(null,e),e=>t(e,e))}),CABLES.talker.addEventListener("deleteFile",(e,t)=>{CABLES.api.delete("project/"+CABLES.patchId+"/file/"+e.fileid,{},(function(e){t(null,e)}),(function(e){t(e,e)}))}),CABLES.talker.addEventListener("checkNumAssetPatches",(e,t)=>{const n=e.filenames||[];CABLES.api.post("assets/uses/count",{filenames:n},(function(e){t(null,e)}),(function(e){t(e,e)}))}),CABLES.talker.addEventListener("createFile",(e,t)=>{CABLES.api.put("project/"+CABLES.patchId+"/"+e.name,{content:"this is an empty file..."},(function(e){t(null,e)}),(function(e){t(e,e)}))}),CABLES.talker.addEventListener("fileUploadStr",(e,t)=>{const n=dataUriToFormData(e.fileStr,e.filename);CABLES.uploadFormadata(n,e.filename)}),CABLES.talker.addEventListener("getAllProjectOps",(function(e,t){CABLES.api.get("ops/project/"+e.projectId+"/?nc="+Date.now(),(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("getAllOps",(function(e,t){CABLES.api.get("ops/?nc="+Date.now(),(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("getOpDocsAll",(function(e,t){CABLES.api.get("doc/ops/all?nc="+String(Date.now()).substr(-6),(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("getOpDocs",(function(e,t){let n="doc/ops/"+e.name+"?nc="+String(Date.now()).substr(-6);e.id&&"undefined"!==e.id&&(n+="&id="+e.id),CABLES.api.get(n,(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("getExtensionOpDocs",(function(e,t){CABLES.api.get("doc/ops/extension/"+e.name+"?nc="+Date.now(),(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("getTeamNamespaceOpDocs",(function(e,t){CABLES.api.get("doc/ops/team/namespace/"+e.name+"?nc="+Date.now(),(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opCreate",(function(e,t){CABLES.api.post("ops/create/"+e.opname,{},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("saveOpCode",(function(e,t){CABLES.api.put("ops/"+e.opname,{code:e.code},(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("getOpCode",(function(e,t){let n="ops/"+e.opname;e.projectId&&(n+="?projectId="+e.projectId),CABLES.api.get(n,(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("getBlueprintOps",(function(e,t){CABLES.api.get("blueprints/"+e.blueprintId+"/"+e.patchId+"/"+e.subPatchId+"/"+e.opId+"/"+e.blueprintSubpatchId+"?nocache="+Date.now(),(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("formatOpCode",(function(e,t){CABLES.api.post("ops/code/format",{code:e.code},(function(e){t(null,e)}),(function(e){t(e,e)}))})),CABLES.talker.addEventListener("opSaveLayout",(function(e,t){CABLES.api.post("op/layout/"+e.opname,{layout:e.layout},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opAddLib",(function(e,t){CABLES.api.put("op/"+e.opname+"/libs",{libName:e.name},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opRemoveLib",(function(e,t){CABLES.api.delete("op/"+e.opname+"/libs",{libName:e.name},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opAddCoreLib",(function(e,t){CABLES.api.put("op/"+e.opname+"/corelibs/"+e.name,{},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opRemoveCoreLib",(function(e,t){CABLES.api.delete("op/"+e.opname+"/corelibs/"+e.name,{},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opClone",(function(e,t){CABLES.api.get("ops/clone/"+e.opname+"/"+e.name,(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opAttachmentAdd",(function(e,t){CABLES.api.post("op/"+e.opname+"/attachments/"+e.name,{},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opAttachmentGet",(function(e,t){CABLES.api.get("op/"+e.opname+"/attachment/"+e.name+"?nc="+(Date.now()+"").substr(-6),(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opAttachmentDelete",(function(e,t){CABLES.api.delete("op/"+e.opname+"/attachments/"+e.name,{},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("opAttachmentSave",(function(e,t){CABLES.api.post("op/"+e.opname+"/attachment/"+e.name,{content:e.content},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("saveUserSettings",(function(e,t){CABLES.api.put("usersettings/",{settings:e.settings},(function(e){t(null,e)}),(function(e,n){t(e,n)}))})),CABLES.talker.addEventListener("toggleMultiplayerSession",(function(e,t){let n=window.location.href;const o=n.indexOf("mp=false")>-1;o?n=n.replaceAll("?mp=false","").replaceAll("&mp=false",""):n.indexOf("?")>-1?n+="&mp="+o:n+="?mp="+o,window.location.href=n}))},CABLES.uploadFormadata=function(e,t){const n="/api/project/"+CABLES.patchId+"/file";CABLES.talker.send("jobStart",{id:"upload"+t,title:"Uploading "+t});const o=new XMLHttpRequest;o.open("POST",n),o.upload.onprogress=function(e){if(e.lengthComputable){const n=e.loaded/e.total*100|0;CABLES.talker.send("jobProgress",{id:"upload"+t,progress:n}),100==n&&(CABLES.talker.send("notify",{msg:"File Uploaded"}),CABLES.talker.send("jobFinish",{id:"upload"+t}),setTimeout((function(){CABLES.talker.send("refreshFileManager"),CABLES.talker.send("fileUpdated",{filename:t})}),500))}},o.onload=function(e,t){let n="",s="";try{s=JSON.parse(e.target.response)}catch(e){console.log(e)}502!==o.status?(200===o.status?CABLES.talker.send("refreshFileManager"):(s.msg&&(n=s.msg),CABLES.talker.send("notifyError",{msg:"Upload error: "+(s.msg||"")}),CABLES.talker.send("refreshFileManager"),console.error("upload error",n)),s.hasOwnProperty("success")&&!s.success&&(CABLES.talker.send("notifyError",{msg:"Upload error: "+(s.msg||"")}),console.error("upload error",s.msg))):console.warn("ajax 502 error ! possibly upload ?")},o.send(e)},(CABLES=CABLES||{}).embedPatch=function(e,t=null){let n=e.sandboxUrl+"/sandboxviewer/"+e.projectId,o=e.secret;if(!o){const e=window.location.search.match(new RegExp("[?&]s=([^&]+)"));e&&e.length>0&&(o=o[1])}o?(n+="?s="+o,e.embedOverlay&&(n+="&embed=true")):e.embedOverlay&&(n+="?embed=true"),e.locationHash&&(n+=e.locationHash),document.getElementById(e.elementId).innerHTML='<iframe id="canvasiframe" frameborder="0" allow="clipboard-read;clipboard-write;geolocation;camera;microphone;midi;usb;serial;xr-spatial-tracking;web-share;ambient-light-sensor" src="'+n+'"  style="width:100%;" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe>';const s=document.getElementById("canvasiframe"),i=new CABLES.TalkerAPI(s.contentWindow);i.addEventListener("sendPatch",(n,s)=>{let a="project/"+e.projectId+"?nocache="+Date.now();if(e.secret||o){a+="&s="+(e.secret||o)}CABLES.api.get(a,e=>{i.send("patch",{patch:e})},n=>{console.warn("api error on url:","project/"+e.projectId+"?nocache="+Date.now()),console.log(n),"function"==typeof t&&t(n)})}),i.addEventListener("sendBlueprint",(n,s)=>{let a="blueprints"+n.url+"?nocache="+Date.now();if(e.secret||o){const t=e.secret||o;a+="&s="+t}CABLES.api.get(a,(function(e){i.send("blueprint",{blueprint:e})}),(function(e){console.warn("api error on url:",a),console.log(e),"function"==typeof t&&t(e)}))})},CABLES.CLIENT=CABLES.CLIENT||{},CABLES.CLIENT.userInfos={},CABLES.CLIENT.loadFavsAndUpdateDom=e=>{CABLES.api.get("favs/"+e,(function(e){const t={};if(t.likes=e,t.likeColumns=Math.max(Math.ceil(e.length/10),1),e){if(e.length>0){const e=getHandleBarHtml("likelist",t);ele.byQueryAll(".fav-hover-view").forEach(t=>{t.innerHTML=e})}ele.byQueryAll(".num-favs").forEach(t=>{t.innerText=e.length})}}))},CABLES.CLIENT.disableIframeScrolling=function(){let e={insideIframe:!1};document.getElementById("canvasiframe").addEventListener("mouseenter",(function(){e.insideIframe=!0,e.scrollX=window.scrollX,e.scrollY=window.scrollY})),document.getElementById("canvasiframe").addEventListener("mouseleave",(function(){e.insideIframe=!1})),document.addEventListener("wheel",(function(t){if(e.insideIframe)return t.preventDefault(),!1}),!1),document.addEventListener("scroll",(function(t){if(e.insideIframe)return t.preventDefault(),window.scrollTo(0,0),!1}))},CABLES.API=CABLES.API||{},CABLES.API.saveProjectDescription=function(e){CABLES.api.post("project/"+e+"/save_description",{content:editor.getValue()},(function(e){e.success?ele.byId("save_status").innerHTML="&nbsp;&nbsp;saved...":ele.byId("save_status").innerHTML="&nbsp;&nbsp;not saved :/",setTimeout((function(){ele.byId("save_status").innerHTML=""}),500)}),(function(e){console.log("err res",e)}))},CABLES.API.updateFav=function(e,t){e?ele.byQueryAll(".fav-icon").forEach(e=>{e.classList.remove("icon-heart"),e.classList.add("icon-heart-fill")}):ele.byQueryAll(".fav-icon").forEach(e=>{e.classList.add("icon-heart"),e.classList.remove("icon-heart-fill")}),CABLES.CLIENT.loadFavsAndUpdateDom(t)},CABLES.API.follow=function(e){CABLES.api.post("follow/"+e,(function(e){}),(function(e){e.followstate?ele.byId("follow-button").innerHTML="Following":ele.byId("follow-button").innerHTML="Follow"}))},CABLES.API.toggleFav=function(e){CABLES.api.post("fav/toggle/"+e,(function(e){}),(function(t){CABLES.API.updateFav(t.favstate,e)}))},CABLES.API.getUserLikes=function(e,t,n=0){t=Number(t),n=Number(n);let o="user/favs/"+e;(t||0===t)&&(o+="?l="+t),n&&(o+="&o="+n),CABLES.api.get(o,(function(e){let o="";for(const t in e.projects)o+=getHandleBarHtml("project",e.projects[t]);ele.byId("projects").innerHTML=o,e.pagination&&initPagination("#projects",e.pagination,t,n,(e,t)=>{let n="";(e||0===e)&&(n+="?l="+e),t&&(n+="&o="+t),window.location=location.origin+location.pathname+n})}))},CABLES.API.getUserFeatured=function(e,t,n=0){t=Number(t),n=Number(n);let o="user/featured/"+e;(t||0===t)&&(o+="?l="+t),n&&(o+="&o="+n),CABLES.api.get(o,(function(e){let o="";for(const t in e.projects)o+=getHandleBarHtml("project",e.projects[t]);ele.byId("projects").innerHTML=o,e.pagination&&initPagination("#results_container",e.pagination,t,n,(e,t)=>{let n="";(e||0===e)&&(n+="?l="+e),t&&(n+="&o="+t),window.location=location.origin+location.pathname+n})}))},CABLES.API.getUserProjects=function(e,t,n,o=0){let s="user/"+e+"/projects";t&&(s="admin/user/"+e+"/projects"),n=Number(n),o=Number(o),(n||0===n)&&(s+="?l="+n),o&&(s+="&o="+o),CABLES.api.get(s,(function(e){let t="";for(const n in e.projects){const o=e.projects[n];o.publishedReadable=o.updatedReadable,t+=getHandleBarHtml("project",e.projects[n])}document.getElementById("projects").innerHTML=t,e.pagination&&initPagination("#results_container",e.pagination,n,o,(e,t)=>{let n="";(e||0===e)&&(n+="?l="+e),t&&(n+="&o="+t),window.location=location.origin+location.pathname+n})}))},CABLES.API.getTeamProjects=function(e,t){let n="teams/"+e+"/projects";CABLES.api.get(n,(function(n){let o="",s=!0;for(const t in n.data){s=!1;const i=n.data[t];i.teamId=e,o+=getHandleBarHtml("myproject",i)}s&&(o='<div class="emptyState cute-12-phone left cute-12-tablet center-tablet"><h3>This team has no patches yet</h3><br/>Go to the collaboration-settings of any patch and assign this team to it.</div>'),document.getElementById(t).innerHTML=o}))},CABLES.API.getTeamNamespaceOps=function(e,t){if(!e)return;let n="teams/namespace/Ops.Team."+e+"/ops",o=!0,s="";CABLES.api.get(n,e=>{for(const t in e.data.ops)o=!1,e.data.ops[t]&&(s+=getHandleBarHtml("projectOp",e.data.ops[t]));s+="</div>",o&&(s='<div class="emptyState cute-12-phone left cute-12-tablet center-tablet"><h3>This namespace has no ops yet</h3><br/>Move a userop to the namespace to share them with the team.</div>'),ele.byQuery(t).innerHTML=s},e=>{s='<div class="emptyState cute-12-phone left cute-12-tablet center-tablet"><h3><span class="icon icon-alert-triangle icon-warning icon-near-text left"></span>Failed to load ops for namespace</h3><br/>'+e.msg+"</div>",ele.byQuery(t).innerHTML=s})},CABLES.API.getTeamExtensionOps=function(e,t){if(!e)return;let n="extension/Ops.Extension."+e+"/ops",o=!0,s="";CABLES.api.get(n,e=>{for(const t in e.data.ops)o=!1,e.data.ops[t]&&(s+=getHandleBarHtml("projectOp",e.data.ops[t]));s+="</div>",o&&(s='<div class="emptyState cute-12-phone left cute-12-tablet center-tablet"><h3>This namespace has no ops yet</h3><br/>Move a userop/teamop to the namespace to share them with the community.</div>'),ele.byQuery(t).innerHTML=s},e=>{s='<div class="emptyState cute-12-phone left cute-12-tablet center-tablet"><h3><span class="icon icon-alert-triangle icon-warning icon-near-text left"></span>Failed to load ops for namespace</h3><br/>'+e.msg+"</div>",ele.byQuery(t).innerHTML=s})},CABLES.API.addTeamAsCollaborators=function(e,t,n){let o="teams/"+t+"/collaborators/add/"+e;CABLES.api.post(o,e=>{console.error("error",e)},e=>{if("function"==typeof n){const t=[];e.data.forEach(e=>{t.push(e.username)}),n(t)}})},CABLES.API.getTags=function(){CABLES.api.get("projects/tags",(function(e){let t="",n=0,o=0;for(o in e)n=Math.max(n,e[o]);for(o in e)t+=getHandleBarHtml("tag",{name:o,size:12+e[o]/n*8});ele.byId("tags").innerHTML=t}))},CABLES.API.getFeaturedProjectsList=function(e){e&&e.selector&&CABLES.api.get("projects/featured",(function(t){let n=getHandleBarHtml("project_list_headline",{title:"<b>Featured</b> Patches"});n+='<div class="row">';for(const e in t)n+=getHandleBarHtml("project",t[e]);n+="</div> \x3c!-- end row --\x3e",ele.byQuery(e.selector).innerHTML=n}))},CABLES.API.getExamples=function(e){e&&e.selector&&CABLES.api.get("examples",(function(t){let n="";for(const e in t)n+=getHandleBarHtml("example",t[e]);ele.byQuery(e.selector).innerHTML=n}))},CABLES.API.getMyFavs=function(e){CABLES.api.get("myfavs",(function(e){let t="";for(const n in e)t+=getHandleBarHtml("project",e[n]);ele.byId("myfavs").innerHTML=t}))},CABLES.API.getMyPatches=function(e,t,n=0,o=0){ele.byQueryAll(".tab-bar li").forEach(e=>{e.classList.remove("active")}),ele.byQueryAll(".tab-bar li[data-tab-name='tab_"+e+"']").forEach(e=>{e.classList.add("active")});const s=ele.byId("namespaces"),i=s.value;CABLES.API.MYPATCHES.lastFilter=e,CABLES.API.MYPATCHES.lastOrder=t,ele.byId("my-projects").innerHTML='<br/><br/><br/><div class="loading" style="margin-bottom:600px;"></div>';let a="mypatches?filter="+e+"&ns="+i+"&sort="+t;n=Number(n),o=Number(o),(n||0===n)&&(a+="&l="+n),o&&(a+="&o="+o),CABLES.api.get(a,(function(a){const r=CABLES.getTagsFromProjects(a),l=ele.byId("tags");l&&(l.innerHTML=getHandleBarHtml("tags",{tags:r})),s.length=0;let c=document.createElement("option");c.value="all",c.innerText="all namespaces","all"===i&&c.setAttribute("selected","selected"),s.appendChild(c),a.namespaces.forEach(e=>{c=document.createElement("option"),c.value=e,c.innerText=e,i===e&&c.setAttribute("selected","selected"),s.appendChild(c)});let d="";d+='<div class="row">';for(const e in a.patches){const n=a.patches[e];"created"===t&&(n.publishedReadable=n.createdReadable),d+=getHandleBarHtml("myproject",a.patches[e])}d+="</div> \x3c!-- end row --\x3e",ele.byId("my-projects").innerHTML=d,a.pagination&&initPagination("#my-projects",a.pagination,n,o,(n,o)=>{CABLES.API.MYPATCHES.setUrl(e,t,n,o)})}))},CABLES.lastPatchTemplates=0,CABLES.API.getTemplateListNav=function(){0===CABLES.lastPatchTemplates&&(CABLES.lastPatchTemplates=Date.now(),CABLES.api.get("templates",(function(e){let t='<div class="template_project project"><div class="image-and-links" style="background-color:black;width:200px;height:113px;">   <a onclick="CABLES.API.newProject();">       <div class="full-image-link edit-link">           <span class="text"><div class="icon icon-plus"></div><br/>Create</span>       </div></a></div><div class="project-infos"><h3 class="project-title">Empty Project</h3></div></div>';for(const n in e)e[n].linkedId=e[n].shortId?e[n].shortId:e[n]._id,t+=getHandleBarHtml("templates_nav",e[n]);ele.byId("template-list-dropdown").innerHTML=t})))},CABLES.lastRecentProjects="recentpatches",CABLES.API.getMyProjectListNav=function(e){if("recentpatches"===e&&CABLES.lastRecentProjects===e)return void(document.location.href="/mypatches");if("recentinvitedpatches"===e&&CABLES.lastRecentProjects===e)return void(document.location.href="/mypatches?w=sharedme");if("teams"===e&&CABLES.lastRecentProjects===e)return void(document.location.href="/teams");const t=document.getElementById("my-recent-projects-dropdown");if(!t)return;t.innerHTML='<div class="loading"></div>',document.getElementById("mypatches_"+CABLES.lastRecentProjects).classList.remove("myPatchesFilterActive"),document.getElementById("mypatches_"+CABLES.lastRecentProjects).classList.add("myPatchesFilterInActive"),e=e||"recentpatches",document.getElementById("mypatches_"+e).classList.add("myPatchesFilterActive"),document.getElementById("mypatches_"+e).classList.remove("myPatchesFilterInActive"),CABLES.lastRecentProjects=e;let n=e;"teams"===e&&(n="teams/mine"),CABLES.api.get(n,(function(n){let o="";if("teams"===e){0===n.data.length&&(o+="<center>No teams yet!<br/><br/></center>"),n.data.length>4&&(n.data.length=4);for(const e in n.data)o+=getHandleBarHtml("team_thumb",n.data[e]);o+='<center><a class="button"href="/teams">Manage your teams</a></center>'}else{n.msg&&(n=n.msg),0===n.length&&(o="None"),n.length>4&&(n.length=4);for(const e in n)o+=getHandleBarHtml("myproject_nav",n[e]);o+="recentinvitedpatches"===e?'<center><a class="button" href="/invites">See all invites</a></center>':'<center><a class="button" href="/mypatches">All my patches</a></center>'}t.innerHTML=o}))},CABLES.API.getMyLatestProjectList=function(){CABLES.api.get("recentpatches",(function(e){let t="";e.length=4;for(const n in e)t+=getHandleBarHtml("project",e[n]);ele.byId("mylatestprojects").innerHTML=t}))},CABLES.API.getProjectList=function(){CABLES.api.get("projects",(function(e){let t="";for(const n in e)t+=getHandleBarHtml("project",e[n]);ele.byId("projectlist").innerHTML=t}))},CABLES.API.comment=function(e){if(""===ele.byQuery(".comment_content textarea").value)return CABLES.stopSavingAnimButton(this);CABLES.api.post("comment/"+e,{content:ele.byQuery(".comment_content textarea").value},(function(t){CABLES.API.getProjectComments(e,!0)}))},CABLES.API.getProjectComments=function(e,t){CABLES.api.get("comments/"+e,(function(n){let o="";n.reverse();for(const e in n)o+=getHandleBarHtml("comment",n[e]);t&&(o+=getHandleBarHtml("comments_head",{numComments:n.length,projectId:e})),ele.byId("project_comments").innerHTML=o,CABLES.stopSavingAnimButton(this)}))},CABLES.getTagsFromProjects=function(e){const t={},n=[];for(const n in e)if(e[n].tags)for(let o=0;o<e[n].tags.length;o++){const s=e[n].tags[o];s!=name&&(t.hasOwnProperty(s)?t[s]++:t[s]=0)}for(const e in t)n.push({name:e,num:t[e],fontsize:2*t[e]+12});return n.sort((e,t)=>e.num-t.num),n},CABLES.API.getTagProjects=function(e){CABLES.api.get("tag/"+e+"/projects",(function(e){let t="";for(const n in e.projects)t+=getHandleBarHtml("project",e.projects[n]);const n=CABLES.getTagsFromProjects(e.projects);ele.byId("tags").innerHTML=getHandleBarHtml("tags",{tags:n}),ele.byId("tag_projects").innerHTML=t,e.projects&&0!==e.projects.length||(ele.byId("tag_projects").innerHTML="No Projects found.")}))},CABLES.API.getOpPatches=function(e,t,n,o,s=0,i=0){const a=document.querySelector("#loading");a&&a.classList.remove("hide");let r="op/"+e+"/patches";s=Number(s),i=Number(i),(s||0===s)&&(r+="?l="+s),i&&(r+="&o="+i),CABLES.api.get(r,(function(e){projectPagePatchList(e.projects,t,o,e.pagination),e.pagination&&initPagination("#"+n,e.pagination,s,i,(e,t)=>{CABLES.API.OPPATCHES.setUrl("public",e,t)}),a&&a.classList.add("hide")}))};const projectPagePatchList=(e,t,n,o={})=>{let s="";for(const t in e)s+=getHandleBarHtml("project",e[t]);const i=document.getElementById(t);i&&(i.innerHTML=s,e&&0!==e.length||(i.innerHTML='<div class="cute-12-phone">'+n+"</div>"))};CABLES.API.getOpMyPatches=function(e,t,n,o,s=0,i=0){const a=document.querySelector("#loading");a&&a.classList.remove("hide");let r="op/"+e+"/mypatches";s=Number(s),i=Number(i),(s||0===s)&&(r+="?l="+s),i&&(r+="&o="+i),CABLES.api.get(r,(function(e){projectPagePatchList(e.projects,t,o,e.pagination),e.pagination&&initPagination("#"+n,e.pagination,s,i,(e,t)=>{CABLES.API.OPPATCHES.setUrl("mine",e,t)}),a&&a.classList.add("hide")}))},CABLES.API.getOpPrivatePatches=function(e,t,n,o,s=0,i=0){const a=document.querySelector("#loading");a&&a.classList.remove("hide");let r="op/"+e+"/privatepatches";s=Number(s),i=Number(i),(s||0===s)&&(r+="?l="+s),i&&(r+="&o="+i),CABLES.api.get(r,e=>{if(projectPagePatchList(e.projects,t,o,e.pagination),e.pagination){const t=document.getElementById("num_private");t&&(t.innerHTML="("+e.pagination.count+")"),initPagination("#"+n,e.pagination,s,i,(e,t)=>{CABLES.API.OPPATCHES.setUrl("private",e,t)})}a&&a.classList.add("hide")})},CABLES.API.getCountOpPatches=function(e,t="(",n=")"){CABLES.api.get("op/"+e+"/count",e=>{if(e&&e.data)for(let o in e.data){const s=document.getElementById("num_"+o);s&&(s.innerHTML=t+e.data[o]+n)}})},CABLES.API.getOpExamples=function(e,t,n,o,s=0,i=0){const a=document.querySelector("#loading");a&&a.classList.remove("hide");let r="op/"+e+"/examples";s=Number(s),i=Number(i),(s||0===s)&&(r+="?l="+s),i&&(r+="&o="+i),CABLES.api.get(r,(function(e){projectPagePatchList(e.projects,t,o,e.pagination),e.pagination&&initPagination("#"+n,e.pagination,s,i,(e,t)=>{CABLES.API.OPPATCHES.setUrl("examples",e,t)}),a&&a.classList.add("hide")}))},CABLES.API.getRandomOps=function(){CABLES.api.get("doc/ops/random",(function(e){let t=getHandleBarHtml("project_list_headline",{link:"/ops",title:"Random Ops"});t+='<div class="row">';for(const n in e.ops)e.ops[n]&&(t+=getHandleBarHtml("projectOp",e.ops[n]));t+="</div>",document.getElementById("random-ops").innerHTML=t}))},CABLES.API.landingPatchteaser=function(){CABLES.api.get("fav/top",(function(e){let t=0,n=getHandleBarHtml("project_list_headline",{link:"/ops",title:""});for(t in n+='<div class="row">',e.topFavs.length>4&&(e.topFavs.length=4),e.topFavs)n+=getHandleBarHtml("project",e.topFavs[t].proj);n+="</div>",document.getElementById("landingteaser").innerHTML=n;let o=getHandleBarHtml("project_list_headline",{link:"/ops",title:""});for(t in o+='<div class="row">',e.allTimeTop.length>4&&(e.allTimeTop.length=4),e.allTimeTop)o+=getHandleBarHtml("project",e.allTimeTop[t].proj);o+="</div>",document.getElementById("landingteaser2").innerHTML=o}))},CABLES.API.getTopProjectList=function(){CABLES.api.get("fav/top",(function(e){let t=0,n=getHandleBarHtml("project_list_headline",{link:"/patches?w=topMonth",title:"Top Of The Month"});for(t in n+='<div class="row">',e.topFavs.length>8&&(e.topFavs.length=8),e.topFavs.length<4&&(e.topFavs.length=Math.min(4,e.topFavs.length)),e.topFavs)n+=getHandleBarHtml("project",e.topFavs[t].proj);n+="</div>",document.getElementById("top-of-the-month").innerHTML=n;let o=getHandleBarHtml("project_list_headline",{link:"/patches?w=ppub&or=favs",title:"Top Patches (Six Months)"});for(t in o+='<div class="row">',e.allTimeTop)o+=getHandleBarHtml("project",e.allTimeTop[t].proj);o+="</div>",document.getElementById("alltimetop").innerHTML=o;const s=document.getElementById("featured");s&&(s.innerHTML=getHandleBarHtml("featured_project",e.featured))}))},CABLES.API.getLatestProjectList=function(){CABLES.api.get("latestProjects",(function(e){let t=getHandleBarHtml("project_list_headline",{link:"/projects",title:"Latest Patches"});t+='<div class="row">',e.length=12;for(const n in e)t+=getHandleBarHtml("project",e[n]);t+="</div>",ele.byId("latest-projects").innerHTML=t}))},CABLES.API.newProject=function(){CABLES.api.post("project/",null,(function(e){const t=e.shortId||e._id;document.location.href="/edit/"+t}))},CABLES.API.checkInvites=()=>{CABLES.api.get("invites/count",(function(e){const t=e.data.count,n=document.getElementById("mypatches_patchinvitesnew"),o=document.getElementById("myPatchesBubble"),s=document.getElementById("myInvites");t>0?(o&&(o.innerHTML=t),o&&o.classList.remove("hide"),s&&(s.innerHTML=t),n&&n.classList.remove("hide"),n&&n.classList.add("block")):(o&&o.classList.add("hide"),n&&n.classList.add("hide"),n&&n.classList.remove("block"))})),CABLES.api.get("teams/mine",(function(e){if(e.data.length>0){const e=document.getElementById("mypatches_teams");e&&(e.classList.remove("hide"),e.classList.add("block"))}}))},(CABLES=CABLES||{}).SEARCH=CABLES.SEARCH||{};const numResults=32;let lastOptions=[],lastTerm="";var CABLES;window.ele&&document.addEventListener("DOMContentLoaded",()=>{const e=ele.byId("headsearch");e&&e.addEventListener("keydown",t=>{13===t.keyCode&&(document.location.href="/search?s="+e.value)});const t=ele.byId("search");t&&t.addEventListener("keydown",t=>{13===t.keyCode&&(document.location.href="/search?s="+e.value)})}),CABLES.SEARCH.setOrder=function(e){lastOptions.order=e,CABLES.SEARCH.setWhat(lastOptions.what,e,lastOptions.limit,lastOptions.offset)},CABLES.SEARCH.didCount=!1,CABLES.SEARCH.getCount=function(){if(CABLES.SEARCH.didCount)return;CABLES.SEARCH.didCount=!0;const e=lastOptions,t=JSON.parse(JSON.stringify(lastOptions));t.count=!0,t.what="ppriv",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_ppriv").innerHTML=" ("+t.numResults+")"}),48),t.what="ppub",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_ppub").innerHTML=" ("+t.numResults+")"}),48),t.what="pshared",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_pshared").innerHTML=" ("+t.numResults+")"}),48),t.what="featured",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_featured").innerHTML=" ("+t.numResults+")"}),48),t.what="example",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_example").innerHTML=" ("+t.numResults+")"}),48),t.what="ops",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_ops").innerHTML=" ("+t.numResults+")"}),48),t.what="u",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_user").innerHTML=" ("+t.numResults+")"}),48),t.what="topMonth",CABLES.SEARCH.search(lastTerm,t,(function(e,t){ele.byId("num_topMonth").innerHTML=" ("+t.numResults+")"}),48),lastOptions=e},CABLES.SEARCH.setWhat=function(e,t,n,o){n=Number(n),o=Number(o);let s="?s="+lastTerm+"&w="+e;t&&(s+="&or="+t),(n||0===n)&&(s+="&l="+n),o&&(s+="&o="+o),window.location.search=s},CABLES.SEARCH.showResults=function(e,t){ele.byId("results").innerHTML="";let n="",o=0;if(t.tags&&t.tags.length>0){for(n+='<div class="cute-12-phone">Related tags: ',o=0;o<t.tags.length;o++)t.tags[o].tag&&""!=t.tags[o].tag&&(n+='<a class="tag " href="/search?s='+t.tags[o].tag+'">'+t.tags[o].tag+"</a> ");n+="</div><br/>"}if(t.projects)for(o in t.projects)n+=getHandleBarHtml("project",t.projects[o]);if(t.users)for(o in t.users)n+=getHandleBarHtml("user",t.users[o]);if(t.items)for(o in t.items)n+=getHandleBarHtml("op",t.items[o]);0===n.length&&(n='<div class="cute-4-tablet cute-3-desktop projectthumb left"><h3>No Results</h3></div>'),ele.byId("results").innerHTML=n,CABLES.SEARCH.getCount(),ele.hide(ele.byId("loading")),ele.show(ele.byId("results"))},CABLES.SEARCH.search=function(e,t,n,o=0,s=0){(t=t||{}).count||(ele.hide(ele.byId("results")),ele.show(ele.byId("loading")));let i="s="+e;if(lastOptions=t,lastOptions.limit=o,lastOptions.offset=s,lastTerm=e,t.order){i+="&or="+t.order;const e=document.getElementById("order");e&&(e.value=t.order)}t.what&&(i+="&w="+t.what),t.count?i+="&count="+!0:(o=Number(o),s=Number(s),(o||0===o)&&(i+="&l="+o),s&&(i+="&o="+s));let a="search?"+i;CABLES.api.get(a,(function(e){n||(n=CABLES.SEARCH.showResults),n(null,e),e.pagination&&initPagination("#results_container",e.pagination,o,s,(e,n)=>{lastOptions.limit=e,lastOptions.offset=n,CABLES.SEARCH.setWhat(t.what,t.order,e,n)})}),(function(e){console.log(e)}))},CABLES.API=CABLES.API||{},CABLES.API.SETTINGS=CABLES.API.SETTINGS||{},CABLES.API.SETTINGS.sendConfirmationEMail=function(){document.getElementById("settings_emailconfirm").innerHTML='<i class="fa fa-spinner fa-spin"></i>',CABLES.api.get("settings/sendConfirmation",(function(e){let t="an error occured, try again later.";e.success&&(t="confirmation email sent. check your inbox"),document.getElementById("settings_emailconfirm").innerHTML=t}))},CABLES.importProject=function(){const e=document.getElementById("hiddenfileElem");e&&e.click()},CABLES.importProjectFile=function(e){const t=new FormData;for(let n in e){const o=e[n];t.append(n,o)}const n=new XMLHttpRequest;n.open("POST","/api/project/import"),n.onload=function(e,t){console.log("ONLOAD..."),console.log(e.target.response);const n=JSON.parse(e.target.response);n.projectId?document.getElementById("importjson").innerHTML='<a href="/edit/'+n.projectId+'">open patch</a>':document.getElementById("importjson").innerHTML="something went wrong..."},n.send(t)},CABLES.ignoreAutoSuggestRequest=!1,CABLES.initializeAutosuggestsFromApi=(e=[],t={})=>{const n=e=>{if(CABLES.ignoreAutoSuggestRequest)return;const n=e.target,o=n.value;t.minLength&&o.length<t.minLength||CABLES.api.get(n.dataset.autosuggest+"?ac="+o,(function(e){const o=[];e.data.forEach(e=>{const t={title:e[n.dataset.autosuggestTitlefield],value:e[n.dataset.autosuggestValuefield]};e.image&&(t.image=e.image),o.push(t)}),CABLES.ignoreAutoSuggestRequest||CABLES.showInputSuggestions(n,o,t)}))};e.forEach(e=>{e.addEventListener("focus",(function(e){CABLES.ignoreAutoSuggestRequest=!1,n(e)})),e.addEventListener("input",n)})},CABLES.showInputSuggestions=(e,t,n={})=>{e.onkeydown=null,document.querySelectorAll(".inputSuggestionList").forEach(e=>e.remove());const o=document.createElement("div");o.classList.add("inputSuggestionList");let s="";for(let e=0;e<t.length;e++)s+='<div data-value="'+t[e].value+'" data-title="'+t[e].title+'">',t[e].image&&(s+='<img src="'+t[e].image+'"/>'),s+=t[e].title,s+="</div>";o.innerHTML=s;const i=e.getBoundingClientRect();o.style.top=i.top+i.height+window.scrollY+"px",o.style.left=i.left+"px",o.style.width=i.width+"px";const a=getComputedStyle(e);o.style.background=a.background,o.style["background-color"]=a["background-color"],o.dataset.selected=0;const r=s=>{const i=s.key;if("ArrowDown"===i)o.dataset.selected++,o.dataset.selected>t.length&&(o.dataset.selected=t.length),o.childNodes.forEach((e,t)=>{const n=t+1;o.dataset.selected==n?(e.classList.add("selected"),o.scrollTop=e.offsetTop):e.classList.remove("selected")});else if("ArrowUp"===i)o.dataset.selected--,o.dataset.selected<1&&(o.dataset.selected=1),o.childNodes.forEach((e,t)=>{const n=t+1;o.dataset.selected==n?(e.classList.add("selected"),o.scrollTop=e.offsetTop):e.classList.remove("selected")});else if("Enter"===i&&o.dataset.selected&&o.dataset.selected>0&&o.dataset.selected<=t.length){let s=t[o.dataset.selected-1].title,i=t[o.dataset.selected-1].title,a=t[o.dataset.selected-1].value;if(n.append){const r=n.seperator||",";s=e.value+=r+t[o.dataset.selected-1].title,i=e.dataset.autosuggestTitle+r+t[o.dataset.selected-1].title,a=e.dataset.autosuggestValue+r+t[o.dataset.selected-1].value,s=s.replace(r+r,r),i=i.replace(r+r,r),a=a.replace(r+r,r)}e.value=s,e.dataset.autosuggestTitle=i,e.dataset.autosuggestValue=a,e.removeEventListener("keydown",r),o.remove()}};e.onkeydown=r,e.addEventListener("blur",()=>{CABLES.ignoreAutoSuggestRequest=!0,setTimeout(()=>{e.onkeydown=null,o.remove()},100)}),o.addEventListener("pointerdown",t=>{n.append?e.value=e.value+","+t.target.dataset.title:e.value=t.target.dataset.title,e.dataset.autosuggestTitle=t.target.dataset.title,e.dataset.autosuggestValue=t.target.dataset.value,e.onkeydown=null,o.remove()}),document.body.appendChild(o)},(CABLES=CABLES||{}).PAGE=CABLES.PAGE||{},CABLES.PAGE.SETTINGS=CABLES.PAGE.SETTINGS||{},CABLES.PAGE.SETTINGS.saveAccount=function(){const e=ele.byId("accountsavebutton");e.innerHTML="Working....",CABLES.api.put("user/account/",{account_email:ele.byId("account_email").value,account_newsletter:document.getElementById("account_newsletter").checked},(function(t){t.success?setTimeout((function(){e.innerHTML="Account updated!"}),500):console.log("fail ",t),console.log("res",t)}),(function(t){e.innerHTML="Something went wrong: "+t.msg,console.log("err res",t)}))},CABLES.PAGE.SETTINGS.deleteAccount=function(e,t){const n=prompt("please enter your username:","");n&&n===t?CABLES.api.delete("user/"+e+"?userName="+t,{},(function(e){window.location="/logout"}),(function(e){document.getElementById("errors_delete").innerHTML="this did not work as expected..."})):document.getElementById("errors_delete").innerHTML="usernames do not match..."},CABLES.PAGE.SETTINGS.saveProfile=function(){const e=ele.byId("profilesavebutton");e.innerHTML="working....";let t=ele.byId("profile-website").value;if(t.length>0){let e=!1;if(-1===t.indexOf("https://")&&-1===t.indexOf("http://")&&(e=!0),-1===t.indexOf(".")&&(e=!0),e)return void(ele.byId("errors_links").innerHTML="Website invalid url");ele.byId("errors_links").innerHTML=""}CABLES.api.put("user/profile/",{profile_bio:ele.byId("profile-bio").value,profile_website:t,profile_twitter:ele.byId("profile-twitter").value,profile_facebook:ele.byId("profile-facebook").value,profile_instagram:ele.byId("profile-instagram").value,profile_mastodon:ele.byId("profile-mastodon").value,profile_country:ele.byId("profile-country").value,profile_city:ele.byId("profile-city").value},(function(t){t.success?setTimeout((function(){e.innerHTML="profile saved!",setTimeout((function(){e.innerHTML="save again"}),3e3)}),500):console.log("fail ",t),console.log("res",t)}),(function(t){e.innerHTML="something went wrong",console.log("err res",t)}))},CABLES.PAGE.SETTINGS.savePassword=function(){const e=ele.byId("passwordSavebutton");e.innerHTML="working....",CABLES.api.put("user/password/",{password1:ele.byId("password1").value,password2:ele.byId("password2").value},(function(t){t.success?setTimeout((function(){e.innerHTML="password changed!",setTimeout((function(){e.innerHTML="set password"}),3e3)}),500):console.log("fail ",t),console.log("res",t)}),(function(t){t.msg?e.innerHTML=t.msg:e.innerHTML="something went wrong",console.log("err res",t),setTimeout((function(){e.innerHTML="set password"}),3e3)}))},CABLES.PAGE.SETTINGS.init=function(){const e=ele.byQueryAll(".tab-bar li");e.forEach(t=>{t.addEventListener("pointerdown",()=>{e.forEach(e=>{e.classList.remove("active")}),t.classList.add("active");const n=t.dataset.tabName;ele.byQueryAll(".tab-bar-content").forEach(e=>{e.classList.add("hidden")}),ele.byQuery(".tab-bar-content[data-tab-name='"+n+"']").classList.remove("hidden")})})},(CABLES=CABLES||{}).TalkerAPI=function(e){CABLES.EventTarget.apply(this),this._talker=new Talker(e,"*"),this._callbackCounter=0,this._callbacks={},this._talker.onMessage=function(e){"callback"==e.data.cmd?this._callbacks[e.data.cb]&&this._callbacks[e.data.cb](e.data.error,e.data.response):this.emitEvent(e.data.cmd,e.data.data,function(t,n){this._talker.send("cables",{cmd:"callback",cb:e.data.cb,response:n,error:t})}.bind(this))}.bind(this)},CABLES.TalkerAPI.prototype.send=function(e,t,n){const o={cmd:e,data:t};n&&(this._callbackCounter++,this._callbacks[this._callbackCounter]=n,o.cb=this._callbackCounter),this._talker.send("cables",o)},CABLES.TEST={},CABLES.overwriteTime=1e-5,CABLES.TEST.Tests=class{constructor(e,t){CABLES.EventTarget.apply(this),this.tests=[],this.testResults=[],this.testsToRun=[],this.selectedTags=new Set,this.runId=uuid(),this.browserTestId=null,this.currentScene=null,this.currentIndex=null,this.testIsRunning=!1,this._codeHost=e,this._sandboxHost=t,this._storageKey="cables_tests_environment",this._currentProjectId=null,this.envConfig=this._buildEnvironmentConfig(),this.allDoneCb=null,"hidden"in document?document.addEventListener("visibilitychange",this.cancelTests):"mozHidden"in document?document.addEventListener("mozvisibilitychange",this.cancelTests):"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",this.cancelTests):"msHidden"in document?document.addEventListener("msvisibilitychange",this.cancelTests):"onfocusin"in document?document.onfocusin=document.onfocusout=this.cancelTests:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=this.cancelTests,this.loadTestLibs(()=>{this.emitEvent("ready")},e=>{this.emitEvent("error")})}getEnvironmentConfig(){return this.envConfig}setEnvironmentConfig(e,t){this.envConfig={codeHost:e,sandboxHost:t},window.localStorage&&window.localStorage.setItem(this._storageKey,JSON.stringify(this.envConfig))}cancelTests(){this.testIsRunning&&(this.testIsRunning=!1,ele.byId("resultall").innerHTML="Testing canceled... do not switch focus to another tab while runnign tests...",ele.byId("resultall").classList.add("warning"))}logTest(e,t){console.log(e,t)}loadTestLibs(e,t){const n="cables.gl"===this.envConfig.codeHost?"cables.min.js":"cables.max.js",o=document.createElement("script");o.type="text/javascript",o.src="//"+this.envConfig.sandboxHost+"/ui/js/"+n+"?nc="+Date.now(),o.onload=()=>{const n="cables.gl"===this.envConfig.codeHost?"libs.core.min.js":"libs.core.js",o=document.createElement("script");o.type="text/javascript",o.src="//"+this.envConfig.sandboxHost+"/ui/js/"+n+"?nc="+Date.now(),o.onload=()=>{const n=document.createElement("script");n.type="text/javascript",n.src="//"+this.envConfig.codeHost+"/api/ops/code?nc="+Date.now(),n.onload=()=>{e&&e()},n.onerror=()=>{t("failed to load "+n.src)},(ele.byQuery("head")||ele.byQuery("body")).appendChild(n)},o.onerror=()=>{t("failed to load "+o.src)},(ele.byQuery("head")||ele.byQuery("body")).appendChild(o)},o.onerror=()=>{t("failed to load "+o.src)},(ele.byQuery("head")||ele.byQuery("body")).appendChild(o)}showResults(e){ele.byId("testresult").innerHTML="";ele.byId("testresult").innerHTML=getHandleBarHtml("test",this.testsToRun[e]);const t=new Image;t.src=this.testsToRun[e].resultData.getImageDataUrl();ele.byId("container_comparison").appendChild(t);const n=this.testsToRun[e].correctImg;ele.byId("container_specification").appendChild(n);ele.byId("container_resultimage").appendChild(this.testsToRun[e].testImg)}runTestId(e,t){CABLES.doBrowserTest(n=>{n&&n.id&&(this.browserTestId=n.id),CABLES.api.get("tests/"+e,e=>{this.runId=uuid(),this.testsToRun=[e],this.testResults=[],this.runTest(0,t)})})}runAllTests(e){CABLES.doBrowserTest(t=>{if(t&&t.id&&(this.browserTestId=t.id),ele.byQueryAll(".testcontainer").forEach(()=>{ele.byQueryAll(".test_failed").forEach(e=>{e.remove()}),ele.byQueryAll(".test_passed").forEach(e=>{e.remove()})}),this.testsToRun=[],0===this.selectedTags.size)this.testsToRun=this.tests;else{const e=".testcontainer:not(.hidden)";ele.byQueryAll(e).forEach(e=>{const t=e.dataset.testIndex;this.testsToRun.push(this.tests[t])})}this.testResults=[],this.runId=uuid(),this.runTest(0,e)})}allTestsFinished(e){const t=ele.byId("testcontrols");t&&t.classList.remove("hidden");const n=ele.byId("viewrun");n&&(n.href="/tests/run/"+this.runId,n.classList.remove("hidden"),n.dataset.runId=this.runId),e&&e(this.testResults||[])}saveResult(e){ele.byId("saveimage-button").innerHTML="saving...",this.logTest("save result... "+e),CABLES.api.put("test/save_result/"+e,{screenshot:ele.byId("glcanvas_"+this.currentIndex).toDataURL()},e=>{ele.byId("saveimage-button").innerHTML="IMAGE SAVED!",this.logTest(e)})}runTest(e,t){if(this.allDoneCb=t,this.testIsRunning)return void this.logTest("test still running...");const n=ele.byId("viewrun");n&&n.classList.add("hidden"),this.testIsRunning=!0,ele.byId("testresult").innerHTML='<div style="">running test...</div>',this.currentScene&&(this.currentScene.dispose(),ele.byId("glcanvas_"+this.currentIndex).remove(),this.currentScene=null,this.logTest("patch disposed...")),this.logTest("***************************************************"),this.logTest("run test ",e+": "+this.testsToRun[e].name),this.currentIndex=e;const o=ele.byId("glContainer"),s=document.createElement("canvas");s.setAttribute("id","glcanvas_"+this.currentIndex),s.setAttribute("width","640"),s.setAttribute("height","360"),s.style.width="640px",s.style.height="360px",o.appendChild(s),this.currentFinished=-1,CABLES.internalNow=function(){return 1e3*CABLES.overwriteTime},CABLES.Timer.prototype.get=function(){return CABLES.overwriteTime},this._resetTimers(1e-5);let i=new CABLES.Patch({glCanvasId:"glcanvas_"+e,prefixAssetPath:"",onFinishedLoading:()=>{this._finishedLoading(i)},canvas:{antialias:!1,preserveDrawingBuffer:!0,alpha:!0},onError(e){console.error("test on error",e)}});CABLES.api.get("project/"+this.testsToRun[e]._id,t=>{const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src="//"+this.envConfig.codeHost+"/api/project/"+this.testsToRun[e]._id+"/libs.js?nc=tests",n.onload=()=>{const n=document.createElement("script");n.type="text/javascript",n.src="//"+this.envConfig.codeHost+"/api/project/"+this.testsToRun[e]._id+"/projectops.js?nc="+Date.now(),n.onload=()=>{this.testResults[e]={},i.deSerialize(t),this.currentScene=i},(ele.byQuery("head")||ele.byQuery("body")).appendChild(n)},(ele.byQuery("head")||ele.byQuery("body")).appendChild(n)})}showAll(e){const t=new Set,n=getQueryVariable("op");let o="tests";n&&(o+="?op="+n),CABLES.api.get(o,n=>{const o=ele.byId("tests");this.tests=n;let s="",i="";const a={};for(const e in n){const o=n[e];o.testIndex=e;const r=[];o.tags&&Array.isArray(o.tags)&&o.tags.forEach(e=>{if(a.hasOwnProperty(e)||(a[e]=0),a[e]++,a[e]>1){const n=this._sanitizeTagName(e);r.push(n),t.add(e)}}),i+=getHandleBarHtml("test_row",{test:o,tagClasses:r.join(" ")}),s+=getHandleBarHtml("project_test",{project:o,tagClasses:r.join(" "),cb:Date.now()})}this._initTagContainer(t),o.innerHTML=i,ele.byId("thumbnails").innerHTML=s,e&&e()})}runBrowserstack(e,t,n,o){CABLES.startSavingAnimButton(e);const s=ele.byId("browserstack-progress");s&&ele.show(s),CABLES.api.post("tests/browserstack",{device:t,os:n,browser:o},e=>{const t=ele.byId("testprogressinner");t&&t.classList.remove("failed");const n=ele.byId("resultall");n&&(n.innerHTML="<br/>&nbsp;");const o=ele.byId("resultcontainer");if(ele.show(o),e.data.runId){const t=e.data.runId,n=ele.byId("viewrun");n&&(n.href="/tests/run/"+t,n.classList.remove("hidden"),n.dataset.runId=t)}CABLES.stopSavingAnimButton()},e=>{const t=ele.byId("resultcontainer");ele.show(t);const n=ele.byId("resultall");n&&(n.innerHTML="<br/>ERROR: "+e.msg.error);const o=ele.byId("testprogressinner");o&&o.classList.add("failed"),CABLES.stopSavingAnimButton()})}filterByTag(e){this.removeAllTagFilters(),this.selectedTags.add(e),this._updateTagSelection()}filterByTags(e){this.selectedTags=new Set(e),this._updateTagSelection()}removeAllTagFilters(){this.selectedTags.clear();ele.byQueryAll(".testcontainer, #thumbnails .project").forEach(e=>{e.classList.remove("hidden"),e.classList.remove("filtered")});ele.byQueryAll("#tagcontainer .tag").forEach(e=>{e.classList.remove("active")}),ele.byId("runalltests").innerHTML="Run all tests",history.replaceState(null,null," "),window.localStorage&&window.localStorage.removeItem("cables_tests_tags")}initCategories(e,t,n=null){e.innerHTML=getHandleBarHtml("test_categories",{categories:t}),this._currentProjectId=n;const o=ele.byQueryAll("#categories li"),s=o[0];o.forEach(e=>{e.addEventListener("pointerdown",()=>{this._setCategoryTab(e,10,0)})});let i=new URL(window.location.href),a=i.searchParams.get("l")||10,r=i.searchParams.get("o")||0;s&&this._setCategoryTab(s,a,r)}_setCategoryTab(e,t,n){const o=ele.byId("loading"),s=ele.byId("testresults");s.innerHTML="",o&&ele.show(o);let i=e.dataset.category;ele.byQueryAll("#categories li").forEach(e=>e.classList.remove("active")),e.classList.add("active"),CABLES.api.post("test/category/results?l="+t+"&o="+n,{projectId:this._currentProjectId,category:i},i=>{if(o&&ele.hide(o),i.data&&Array.isArray(i.data)){let e="<table>";i.data.forEach(t=>{e+=getHandleBarHtml("test_resultrow",t)}),s.innerHTML=e+"</table>"}i.pagination&&initPagination("#pagination",i.pagination,t,n,(t,n)=>{this._setCategoryTab(e,t,n)})})}initEnvironments(e,t){e.innerHTML=getHandleBarHtml("test_environments",{environments:t});const n=this.getEnvironmentConfig(),o=ele.byId("codeHost");o&&(o.value=n.codeHost);const s=ele.byId("sandboxHost");s&&(s.value=n.sandboxHost);const i=ele.byId("addTestEnv");i&&i.addEventListener("pointerdown",()=>{this.setEnvironmentConfig(o.value,s.value),window.location.reload()});const a=ele.byQueryAll("#environments li");let r=!1;if(a.forEach(e=>{e.dataset.codeHost===n.codeHost&&(r=!0),e.addEventListener("pointerdown",()=>{a.forEach(e=>e.classList.remove("active")),e.classList.add("active"),this.setEnvironmentConfig(e.dataset.codeHost,e.dataset.sandboxHost),window.location.reload()})}),!r){const e=ele.byId("environments"),t=document.createElement("li");t.dataset.codeHost=n.codeHost,t.dataset.sandboxHost=n.sandboxHost,t.innerText=n.codeHost,e.appendChild(t)}const l=ele.byQuery('#environments li[data-code-host="'+n.codeHost+'"]');l&&l.classList.add("active");const c=ele.byId("add_test_env");c&&c.addEventListener("pointerdown",()=>{const e=ele.byId("add_env"),t=e.classList.contains("hidden");e.classList.toggle("hidden"),t?(c.classList.remove("icon-plus"),c.classList.add("icon-minus")):(c.classList.add("icon-plus"),c.classList.remove("icon-minus"))})}_updateTagSelection(){ele.byQueryAll(".testcontainer, #thumbnails .project").forEach(e=>{this.selectedTags.forEach(t=>{if(e.classList.contains(String(t))&&!e.classList.contains("filtered"))e.classList.remove("hidden");else{const n=".tag[data-tag='"+t+"']";ele.byQueryAll(n).forEach(e=>{e.classList.add("active")}),e.classList.add("hidden"),e.classList.add("filtered")}})}),ele.byId("runalltests").innerHTML="run tests",window.location.hash=Array.from(this.selectedTags).join(",")}_getTestRow(e,t){const n=document.createElement("div");try{const o=document.createElement("a");o.href="/tests/"+t._id,o.appendChild(document.createTextNode(t.name+" ")),n.appendChild(o),n.classList.add("testcontainer"),n.setAttribute("id","test_"+e),n.dataset.testIndex=e}catch(e){this.logTest(t.name,"exception ",e)}return n}_initTagContainer(e){const t=ele.byId("tagcontainer");t&&e.forEach(e=>{const n=this._sanitizeTagName(e),o=document.createElement("a");o.innerText=e,o.classList.add("tag"),o.dataset.tag=n,o.onclick=()=>{o.classList.contains("active")?(o.classList.remove("active"),this.removeAllTagFilters()):(o.classList.add("active"),this.filterByTag(n))},t.appendChild(o)})}_sanitizeTagName(e){let t=e||"";return t=t.toLowerCase(),t=t.split(" ").join("_"),t=t.replace(/\./g,"_"),t.match(/^\d/)&&(t="u_"+t),t}_updateProgress(){let e=0,t="";for(let t=0;t<this.testResults.length;t++)this.testResults[t]&&!this.testResults[t].passed&&e++;t+="<br/>failed: "+e+"/"+this.testsToRun.length;const n=ele.byId("testprogressinner");n&&(e>0?n.classList.add("failed"):n.classList.remove("failed"),ele.byId("testprogressinner").style.width=Math.round(this.currentIndex/(this.testsToRun.length-1)*100)+"%");const o=ele.byId("resultall");o&&(o.innerHTML=t);const s=ele.byId("testcontrols");s&&s.classList.add("hidden");const i=ele.byId("resultcontainer");i&&i.classList.remove("hidden")}_saveResultToServer(e,t,n,o,s,i){let a="failed";o&&(a="passed");let r=null;const l=document.getElementById("resultimage_"+i);l&&(r=l.src);const c=s.resultData.getImageDataUrl(),d={run:e,status:a,browserInfo:t,resultThreshold:s.resultData?s.resultData.rawMisMatchPercentage:null,platform:platform||{},resultData:s.resultData,comparisonImage:c,renderImage:r,codeHost:this.envConfig.codeHost,sandboxHost:this.envConfig.sandboxHost};CABLES.api.put("test/save/"+n,d,e=>{const t=ele.byId("testresulturl");t&&t.setAttribute("href",e.data.resultUrl)},()=>{this.logTest("ERROR SAVING TO SERVER")})}_rendered(e){e.pause(),this.logTest("rendered...",e.getFrameNum());const t=new Image,n=new Image;n.setAttribute("id","resultimage_"+this.currentIndex),n.src=ele.byId("glcanvas_"+this.currentIndex).toDataURL(),t.onabort=t.onerror=()=>{ele.byId("testresult").innerHTML="",this.testIsRunning=!1;const e=ele.byId("testresult"),t=document.createElement("div");t.appendChild(document.createTextNode("could not load correct image to compare...")),this.logTest("could not load correct image to compare...",this.testsToRun[this.currentIndex].name),t.classList.add("failed"),this.testResults[this.currentIndex].passed=!1,e.appendChild(t);const n=ele.byId("test_"+this.currentIndex);n.classList.add("testcontainer"),n.classList.add("failed"),this.logTest("not complete.... ignore..."),this._updateProgress(),this.testsToRun[this.currentIndex+1]?this.runTest(this.currentIndex+1):this.allTestsFinished(this.allDoneCb)},t.onload=()=>{this.testsToRun[this.currentIndex].correctImg=t,this.testsToRun[this.currentIndex].testImg=n,resemble(n.src).compareTo(t.src).onComplete(e=>{this._onResembleComplete(e,this.testsToRun[this.currentIndex],this.allDoneCb)})},t.src="/api/test/result/"+this.testsToRun[this.currentIndex]._id+"?nc="+Date.now()}_resetTimers(e){CABLES.overwriteTime=e}_finishedLoading(e){e.onFinishedLoading=null,this.logTest("finishedloading...",e.getFrameNum()),this.currentFinished!==e.config.glCanvasId&&(this.currentFinished=e.config.glCanvasId,e.pause(),this._resetTimers(.01),e.renderOneFrame(),e.renderOneFrame(),this._resetTimers(.3),e.renderOneFrame(),e.onOneFrameRendered=()=>{this._rendered(e)},e.renderOneFrame(),e.pause(),this._resetTimers(1e-5))}_onResembleComplete(e,t,n){if(!this.testResults[this.currentIndex])return;if(this.testResults[this.currentIndex]&&this.testResults[this.currentIndex].hasOwnProperty("passed"))return;const o=ele.byId("test_"+t.testIndex);let s="passed";this.logTest("currentIndex",this.currentIndex,this.testResults[this.currentIndex]),this.testResults[this.currentIndex].passed=!0,this.testResults[this.currentIndex].name=this.testsToRun[this.currentIndex].name,this.testResults[this.currentIndex].projectId=this.testsToRun[this.currentIndex]._id,e.misMatchPercentage>2&&(s="failed",this.testResults[this.currentIndex].passed=!1),this.logTest("result ",this.testsToRun[this.currentIndex].name,this.testResults[this.currentIndex].passed);const i=ele.byId("testthumb_"+this.testsToRun[this.currentIndex]._id);if(i)if("passed"===s)i.style.border="3px solid green";else{i.style.border="3px solid red";const t=e.getImageDataUrl();i.setAttribute("src",t)}if(o){const e=document.createElement("span");e.classList.add("test_"+s),e.innerText=s,o.appendChild(e)}this.testsToRun[this.currentIndex].resultClass=s,this.testsToRun[this.currentIndex].resultData=e,this.showResults(this.currentIndex),this.testIsRunning=!1,this.logTest("complete...."),this._saveResultToServer(this.runId,this.browserTestId,this.testsToRun[this.currentIndex]._id,this.testResults[this.currentIndex].passed,this.testsToRun[this.currentIndex],this.currentIndex),this._updateProgress(),this.testsToRun[this.currentIndex+1]?this.runTest(this.currentIndex+1):this.allTestsFinished(n)}_buildEnvironmentConfig(){let e={codeHost:this._codeHost,sandboxHost:this._sandboxHost};if(window.localStorage&&window.localStorage.getItem(this._storageKey))try{const t=JSON.parse(window.localStorage.getItem(this._storageKey));t.codeHost&&(e.codeHost=t.codeHost),t.sandboxHost&&(e.sandboxHost=t.sandboxHost)}catch(t){this.logTest("could not parse stored testenvironment, using",e.codeHost,e.sandboxHost,"error: ",t)}return e}};
//# sourceMappingURL=script.min.js.map
CABLES.API.build = {"timestamp":1671443420321,"created":"2022-12-19T09:50:20.321Z","git":{"branch":"master","commit":"739587e6bcac1872e707cf575961a89230dc30d1","date":"2022-12-19T09:48:19.000Z","message":"changelogitem headline"}};